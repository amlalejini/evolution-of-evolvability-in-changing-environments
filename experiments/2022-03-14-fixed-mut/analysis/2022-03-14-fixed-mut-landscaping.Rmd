# 2022-03-14 - Fixed Mutation Rates - Landscape analyses

## Setup

```{r}
experiment_slug <- "2022-03-14-fixed-mut"
working_directory <- paste0("experiments/",experiment_slug,"/analysis/")
```

### Analysis dependencies

Load all required R libraries

```{r}
library(tidyverse)
library(ggplot2)
library(scales)
library(cowplot)
library(RColorBrewer)
library(viridis)
source("https://gist.githubusercontent.com/benmarwick/2a1bb0133ff568cbe28d/raw/fb53bd97121f7f9ce947837ef1a4c65a73bffb3f/geom_flat_violin.R")
```

These analyses were knit with the following environment:

```{r}
print(version)
```

### Load data

Load 1-step landscape data
```{r}
ls1_run_summary_data_loc <- paste0(working_directory, "data/landscape_run_summary_step-1.csv")
ls1_run_summary_data <- read.csv(ls1_run_summary_data_loc, na.strings="NONE")

ls1_run_summary_data$COPY_MUT_PROB <- as.factor(
  ls1_run_summary_data$COPY_MUT_PROB
)
ls1_run_summary_data$env_chg_rate <- as.factor(
  ls1_run_summary_data$env_chg_rate
)
ls1_run_summary_data$env_condition <- as.factor(
  ls1_run_summary_data$env_condition
)
ls1_run_summary_data$env_type <- as.factor(
  ls1_run_summary_data$env_type
)

get_env_chg_rate_label <- function(env_chg_rate, env_type) {
  if (env_chg_rate == "none" && env_type=="consta") {
    return("none-a")
  } else if (env_chg_rate == "none" && env_type=="constb") {
    return("none-b")
  } else if (env_chg_rate=="30") {
    return("30")
  } else if (env_chg_rate=="300") {
    return("300")
  } else if (env_chg_rate=="3000") {
    return("3000")
  } else {
    return("unknown")
  }
}
get_env_type_label <- function(env_type) {
  if (env_type=="consta" || env_type=="constb") {
    return("const")
  } else if (env_type=="cycling") {
    return("cycling")
  } else if (env_type=="random") {
    return("random")
  }
}
ls1_run_summary_data$env_chg_rate_label <- mapply(
  get_env_chg_rate_label,
  ls1_run_summary_data$env_chg_rate,
  ls1_run_summary_data$env_type
)
ls1_run_summary_data$env_chg_rate_label <- factor(
  ls1_run_summary_data$env_chg_rate_label,
  levels=c(
    "none-a",
    "none-b",
    "30",
    "300",
    "3000"
  )
)
ls1_run_summary_data$env_type_label <- mapply(
  get_env_type_label,
  ls1_run_summary_data$env_type
)
```

Load 1-step task co-occurrence data.
```{r}
ls1_cooccur_data_loc <- paste0(working_directory, "data/landscape_task_cooccurrence_treatment_summary_step-1.csv")
ls1_cooccur_data <- read.csv(ls1_cooccur_data_loc, na.strings="NONE")

ls1_cooccur_data$COPY_MUT_PROB <- as.factor(
  ls1_cooccur_data$COPY_MUT_PROB
)
ls1_cooccur_data$env_chg_rate <- as.factor(
  ls1_cooccur_data$env_chg_rate
)
ls1_cooccur_data$env_condition <- as.factor(
  ls1_cooccur_data$env_condition
)
ls1_cooccur_data$env_type <- as.factor(
  ls1_cooccur_data$env_type
)
ls1_cooccur_data$task_1_id <- as.factor(
  ls1_cooccur_data$task_1_id
)
ls1_cooccur_data$task_2_id <- as.factor(
  ls1_cooccur_data$task_2_id
)

ls1_cooccur_data$env_chg_rate_label <- mapply(
  get_env_chg_rate_label,
  ls1_cooccur_data$env_chg_rate,
  ls1_cooccur_data$env_type
)
ls1_cooccur_data$env_chg_rate_label <- factor(
  ls1_cooccur_data$env_chg_rate_label,
  levels=c(
    "none-a",
    "none-b",
    "30",
    "300",
    "3000"
  )
)
ls1_cooccur_data$env_type_label <- mapply(
  get_env_type_label,
  ls1_cooccur_data$env_type
)
```

Load 1-step mutant phenotype distance distributions

```{r}
ls1_phen_dists_data_loc <- paste0(working_directory, "data/mutant_phenotype_distances_step-1.csv")
ls1_phen_dists_data <- read.csv(ls1_phen_dists_data_loc, na.strings="NONE")

ls1_phen_dists_data$COPY_MUT_PROB <- as.factor(
  ls1_phen_dists_data$COPY_MUT_PROB
)
ls1_phen_dists_data$env_chg_rate <- as.factor(
  ls1_phen_dists_data$env_chg_rate
)
ls1_phen_dists_data$env_condition <- as.factor(
  ls1_phen_dists_data$env_condition
)
ls1_phen_dists_data$env_type <- as.factor(
  ls1_phen_dists_data$env_type
)
ls1_phen_dists_data$distance <- factor(
  ls1_phen_dists_data$distance,
  levels=c(
    -1,
    0,
    1,
    2,
    3,
    4,
    5,
    6
  )
)

# Hacky/inefficient way to assign rep_ids based on replicate_id ordering
ls1_simplify_replicate_id <- function(e, m, rep_id) {
  treatment_data <- filter(
    ls1_phen_dists_data,
    (env_condition==e) & (COPY_MUT_PROB==m)
  )
  rep_ids <- as.integer(levels(factor(treatment_data$replicate_id)))
  rep_id_map <- as.data.frame(rep_ids)
  rep_id_map$order <- order(rep_id_map$rep_ids)
  return(filter(rep_id_map, rep_ids==rep_id)$order)
}
ls1_phen_dists_data$rep_id <- mapply(
  ls1_simplify_replicate_id,
  ls1_phen_dists_data$env_condition,
  ls1_phen_dists_data$COPY_MUT_PROB,
  ls1_phen_dists_data$replicate_id
)
ls1_phen_dists_data$rep_id <- as.factor(
  ls1_phen_dists_data$rep_id
)


ls1_phen_dists_data$replicate_id <- as.factor(
  ls1_phen_dists_data$replicate_id
)
ls1_phen_dists_data$RANDOM_SEED <- as.factor(
  ls1_phen_dists_data$RANDOM_SEED
)

ls1_phen_dists_data$env_chg_rate_label <- mapply(
  get_env_chg_rate_label,
  ls1_phen_dists_data$env_chg_rate,
  ls1_phen_dists_data$env_type
)
ls1_phen_dists_data$env_chg_rate_label <- factor(
  ls1_phen_dists_data$env_chg_rate_label,
  levels=c(
    "none-a",
    "none-b",
    "30",
    "300",
    "3000"
  )
)
ls1_phen_dists_data$env_type_label <- mapply(
  get_env_type_label,
  ls1_phen_dists_data$env_type
)
```

Load 1-step task toggle count distribution data

```{r}
ls1_task_toggle_data_loc <- paste0(working_directory, "data/mutant_task_toggle_distribution_step-1.csv")
ls1_task_toggle_data <- read.csv(ls1_task_toggle_data_loc, na.strings="NONE")

ls1_task_toggle_data$COPY_MUT_PROB <- as.factor(
  ls1_task_toggle_data$COPY_MUT_PROB
)
ls1_task_toggle_data$env_chg_rate <- as.factor(
  ls1_task_toggle_data$env_chg_rate
)
ls1_task_toggle_data$env_condition <- as.factor(
  ls1_task_toggle_data$env_condition
)
ls1_task_toggle_data$env_type <- as.factor(
  ls1_task_toggle_data$env_type
)
ls1_task_toggle_data$num_tasks_toggled <- factor(
  ls1_task_toggle_data$num_tasks_toggled,
  levels=c(
    -1,
    0,
    1,
    2,
    3,
    4,
    5,
    6
  )
)

# Hacky/inefficient way to assign rep_ids based on replicate_id ordering
ls1_task_toggle_simplify_replicate_id <- function(e, m, rep_id) {
  treatment_data <- filter(
    ls1_task_toggle_data,
    (env_condition==e) & (COPY_MUT_PROB==m)
  )
  rep_ids <- as.integer(levels(factor(treatment_data$RANDOM_SEED)))
  rep_id_map <- as.data.frame(rep_ids)
  rep_id_map$order <- order(rep_id_map$rep_ids)
  return(filter(rep_id_map, rep_ids==rep_id)$order)
}
ls1_task_toggle_data$rep_id <- mapply(
  ls1_task_toggle_simplify_replicate_id,
  ls1_task_toggle_data$env_condition,
  ls1_task_toggle_data$COPY_MUT_PROB,
  ls1_task_toggle_data$RANDOM_SEED
)
ls1_task_toggle_data$rep_id <- as.factor(
  ls1_task_toggle_data$rep_id
)

ls1_task_toggle_data$RANDOM_SEED <- as.factor(
  ls1_task_toggle_data$RANDOM_SEED
)

ls1_task_toggle_data$env_chg_rate_label <- mapply(
  get_env_chg_rate_label,
  ls1_task_toggle_data$env_chg_rate,
  ls1_task_toggle_data$env_type
)
ls1_task_toggle_data$env_chg_rate_label <- factor(
  ls1_task_toggle_data$env_chg_rate_label,
  levels=c(
    "none-a",
    "none-b",
    "30",
    "300",
    "3000"
  )
)
ls1_task_toggle_data$env_type_label <- mapply(
  get_env_type_label,
  ls1_task_toggle_data$env_type
)
```

Load 2-step landscape data
```{r}
ls2_run_summary_data_loc <- paste0(working_directory, "data/landscape_run_summary_step-2.csv")
ls2_run_summary_data <- read.csv(ls2_run_summary_data_loc, na.strings="NONE")

ls2_run_summary_data$COPY_MUT_PROB <- as.factor(
  ls2_run_summary_data$COPY_MUT_PROB
)
ls2_run_summary_data$env_chg_rate <- as.factor(
  ls2_run_summary_data$env_chg_rate
)
ls2_run_summary_data$env_condition <- as.factor(
  ls2_run_summary_data$env_condition
)
ls2_run_summary_data$env_type <- as.factor(
  ls2_run_summary_data$env_type
)

ls2_run_summary_data$env_chg_rate_label <- mapply(
  get_env_chg_rate_label,
  ls2_run_summary_data$env_chg_rate,
  ls2_run_summary_data$env_type
)
ls2_run_summary_data$env_chg_rate_label <- factor(
  ls2_run_summary_data$env_chg_rate_label,
  levels=c(
    "none-a",
    "none-b",
    "30",
    "300",
    "3000"
  )
)
ls2_run_summary_data$env_type_label <- mapply(
  get_env_type_label,
  ls2_run_summary_data$env_type
)
```

Load 2-step task co-occurrence data.
```{r}
ls2_cooccur_data_loc <- paste0(
  working_directory,
  "data/landscape_task_cooccurrence_treatment_summary_step-2.csv"
)
ls2_cooccur_data <- read.csv(ls2_cooccur_data_loc, na.strings="NONE")

ls2_cooccur_data$COPY_MUT_PROB <- as.factor(
  ls2_cooccur_data$COPY_MUT_PROB
)
ls2_cooccur_data$env_chg_rate <- as.factor(
  ls2_cooccur_data$env_chg_rate
)
ls2_cooccur_data$env_condition <- as.factor(
  ls2_cooccur_data$env_condition
)
ls2_cooccur_data$env_type <- as.factor(
  ls2_cooccur_data$env_type
)
ls2_cooccur_data$task_1_id <- as.factor(
  ls2_cooccur_data$task_1_id
)
ls2_cooccur_data$task_2_id <- as.factor(
  ls2_cooccur_data$task_2_id
)

ls2_cooccur_data$env_chg_rate_label <- mapply(
  get_env_chg_rate_label,
  ls2_cooccur_data$env_chg_rate,
  ls2_cooccur_data$env_type
)
ls2_cooccur_data$env_chg_rate_label <- factor(
  ls2_cooccur_data$env_chg_rate_label,
  levels=c(
    "none-a",
    "none-b",
    "30",
    "300",
    "3000"
  )
)
ls2_cooccur_data$env_type_label <- mapply(
  get_env_type_label,
  ls2_cooccur_data$env_type
)
```

```{r}
ls2_phen_dists_data_loc <- paste0(working_directory, "data/mutant_phenotype_distances_step-2.csv")
ls2_phen_dists_data <- read.csv(ls2_phen_dists_data_loc, na.strings="NONE")

ls2_phen_dists_data$COPY_MUT_PROB <- as.factor(
  ls2_phen_dists_data$COPY_MUT_PROB
)
ls2_phen_dists_data$env_chg_rate <- as.factor(
  ls2_phen_dists_data$env_chg_rate
)
ls2_phen_dists_data$env_condition <- as.factor(
  ls2_phen_dists_data$env_condition
)
ls2_phen_dists_data$env_type <- as.factor(
  ls2_phen_dists_data$env_type
)

ls2_phen_dists_data$distance <- factor(
  ls2_phen_dists_data$distance,
  levels=c(
    -1,
    0,
    1,
    2,
    3,
    4,
    5,
    6
  )
)

# Hacky/inefficient way to assign rep_ids based on replicate_id ordering
ls2_simplify_replicate_id <- function(e, m, rep_id) {
  treatment_data <- filter(
    ls2_phen_dists_data,
    (env_condition==e) & (COPY_MUT_PROB==m)
  )
  rep_ids <- as.integer(levels(factor(treatment_data$replicate_id)))
  rep_id_map <- as.data.frame(rep_ids)
  rep_id_map$order <- order(rep_id_map$rep_ids)
  return(filter(rep_id_map, rep_ids==rep_id)$order)
}
ls2_phen_dists_data$rep_id <- mapply(
  ls2_simplify_replicate_id,
  ls2_phen_dists_data$env_condition,
  ls2_phen_dists_data$COPY_MUT_PROB,
  ls2_phen_dists_data$replicate_id
)
ls2_phen_dists_data$rep_id <- as.factor(
  ls2_phen_dists_data$rep_id
)

ls2_phen_dists_data$replicate_id <- as.factor(
  ls2_phen_dists_data$replicate_id
)
ls2_phen_dists_data$RANDOM_SEED <- as.factor(
  ls2_phen_dists_data$RANDOM_SEED
)

ls2_phen_dists_data$env_chg_rate_label <- mapply(
  get_env_chg_rate_label,
  ls2_phen_dists_data$env_chg_rate,
  ls2_phen_dists_data$env_type
)
ls2_phen_dists_data$env_chg_rate_label <- factor(
  ls2_phen_dists_data$env_chg_rate_label,
  levels=c(
    "none-a",
    "none-b",
    "30",
    "300",
    "3000"
  )
)
ls2_phen_dists_data$env_type_label <- mapply(
  get_env_type_label,
  ls2_phen_dists_data$env_type
)
```


Load run summary data

```{r}
summary_data_loc <- paste0(working_directory, "data/aggregate.csv")
summary_data <- read.csv(summary_data_loc, na.strings="NONE")

summary_data$COPY_MUT_PROB <- as.factor(
  summary_data$COPY_MUT_PROB
)
summary_data$env_chg_rate <- as.factor(
  summary_data$env_chg_rate
)
summary_data$env_condition <- as.factor(
  summary_data$env_condition
)
summary_data$env_type <- as.factor(
  summary_data$env_type
)

# Add final mutation rate to landscape summary data
get_final_mut_rate <- function(seed) {
  filtered_data <- filter(summary_data, RANDOM_SEED==seed)
  return(filtered_data$final_average_copy_mutation_rate)
}
ls1_run_summary_data$final_average_copy_mutation_rate <- mapply(
  get_final_mut_rate,
  ls1_run_summary_data$RANDOM_SEED
)
ls2_run_summary_data$final_average_copy_mutation_rate <- mapply(
  get_final_mut_rate,
  ls2_run_summary_data$RANDOM_SEED
)

get_dom_match_score_env_a <- function(seed) {
  filtered_data <- filter(summary_data, RANDOM_SEED==seed)
  return(filtered_data$dom_match_score_env_a)
}

ls2_phen_dists_data$dom_match_score_env_a <- mapply(
  get_dom_match_score_env_a,
  ls2_phen_dists_data$RANDOM_SEED
)
```

Miscellaneous setup.

```{r}
# Configure our default graphing theme
theme_set(theme_cowplot())
# Palette
cb_palette <- "Set2"
alpha <- 0.05
# Create a directory to store plots
plot_directory <- paste0(working_directory, "plots/")
dir.create(plot_directory, showWarnings=FALSE)
```

## Number of viable mutants

### 1-step mutants

```{r}
ggplot(
    ls1_run_summary_data,
    aes(
      x=env_chg_rate_label,
      y=prop_viable,
      fill=env_condition
    )
  ) +
  geom_flat_violin(
    position = position_nudge(x = .2, y = 0),
    alpha = .8,
    adjust=1.5
  ) +
  geom_point(
    mapping=aes(color=env_condition),
    position = position_jitter(width = .15),
    size = .5,
    alpha = 0.8
  ) +
  geom_boxplot(
    width = .1,
    outlier.shape = NA,
    alpha = 0.5
  ) +
  scale_fill_brewer(
    palette=cb_palette
  ) +
  scale_color_brewer(
    palette=cb_palette
  ) +
  facet_grid(
    COPY_MUT_PROB~env_type_label,
    scales="free_x"
  ) +
  theme(
    legend.position="none",
    axis.text=element_text(size=14),
    # axis.text.x = element_text(angle = 90),
    panel.border = element_rect(color = "grey", fill=NA, size=1.5)
  )
ggsave(
  paste0(working_directory, "plots/", "prop_viable_mutants_step-1.png")
)
```

### 2-step mutants

```{r}
ggplot(
    ls2_run_summary_data,
    aes(
      x=env_chg_rate_label,
      y=prop_viable,
      fill=env_condition
    )
  ) +
  geom_flat_violin(
    position = position_nudge(x = .2, y = 0),
    alpha = .8,
    adjust=1.5
  ) +
  geom_point(
    mapping=aes(color=env_condition),
    position = position_jitter(width = .15),
    size = .5,
    alpha = 0.8
  ) +
  geom_boxplot(
    width = .1,
    outlier.shape = NA,
    alpha = 0.5
  ) +
  scale_fill_brewer(
    palette=cb_palette
  ) +
  scale_color_brewer(
    palette=cb_palette
  ) +
  facet_grid(
    COPY_MUT_PROB~env_type_label,
    scales="free_x"
  ) +
  theme(
    legend.position="none",
    axis.text=element_text(size=14),
    # axis.text.x = element_text(angle = 90),
    panel.border = element_rect(color = "grey", fill=NA, size=1.5)
  )
ggsave(
  paste0(working_directory, "plots/", "prop_viable_mutants_step-2.png")
)
```

## Number of unique phenotypes

### 1-step mutants

```{r}
ggplot(
    ls1_run_summary_data,
    aes(
      x=env_chg_rate_label,
      y=num_unique_viable_phenotypes,
      fill=env_condition
    )
  ) +
  geom_flat_violin(
    position = position_nudge(x = .2, y = 0),
    alpha = .8,
    adjust=1.5
  ) +
  geom_point(
    mapping=aes(color=env_condition),
    position = position_jitter(width = .15),
    size = .5,
    alpha = 0.8
  ) +
  geom_boxplot(
    width = .1,
    outlier.shape = NA,
    alpha = 0.5
  ) +
  scale_fill_brewer(
    palette=cb_palette
  ) +
  scale_color_brewer(
    palette=cb_palette
  ) +
  facet_grid(
    COPY_MUT_PROB~env_type_label,
    scales="free_x"
  ) +
  theme(
    legend.position="none",
    axis.text=element_text(size=14),
    panel.border = element_rect(color = "grey", fill=NA, size=1.5)
  )
ggsave(
  paste0(working_directory, "plots/", "num_unique_viable_phenotypes_step-1.png")
)
```

### 2-step mutants

```{r}
ggplot(
    ls2_run_summary_data,
    aes(
      x=env_chg_rate_label,
      y=num_unique_viable_phenotypes,
      fill=env_condition
    )
  ) +
  geom_flat_violin(
    position = position_nudge(x = .2, y = 0),
    alpha = .8,
    adjust=1.5
  ) +
  geom_point(
    mapping=aes(color=env_condition),
    position = position_jitter(width = .15),
    size = .5,
    alpha = 0.8
  ) +
  geom_boxplot(
    width = .1,
    outlier.shape = NA,
    alpha = 0.5
  ) +
  scale_fill_brewer(
    palette=cb_palette
  ) +
  scale_color_brewer(
    palette=cb_palette
  ) +
  facet_grid(
    COPY_MUT_PROB~env_type_label,
    scales="free_x"
  ) +
  theme(
    legend.position="none",
    axis.text=element_text(size=14),
    panel.border = element_rect(color = "grey", fill=NA, size=1.5)
  )
ggsave(
  paste0(working_directory, "plots/", "num_unique_viable_phenotypes_step-2.png")
)
```

## Entropy of phenotypes

### 1-step mutants

```{r}
ggplot(
    ls1_run_summary_data,
    aes(
      x=env_chg_rate_label,
      y=entropy_viable_phenotypes,
      fill=env_condition
    )
  ) +
  geom_flat_violin(
    position = position_nudge(x = .2, y = 0),
    alpha = .8,
    adjust=1.5
  ) +
  geom_point(
    mapping=aes(color=env_condition),
    position = position_jitter(width = .15),
    size = .5,
    alpha = 0.8
  ) +
  geom_boxplot(
    width = .1,
    outlier.shape = NA,
    alpha = 0.5
  ) +
  scale_fill_brewer(
    palette=cb_palette
  ) +
  scale_color_brewer(
    palette=cb_palette
  ) +
  facet_grid(
    COPY_MUT_PROB~env_type_label,
    scales="free_x"
  ) +
  theme(
    legend.position="none",
    axis.text=element_text(size=14),
    panel.border = element_rect(color = "grey", fill=NA, size=1.5)
  )

ggsave(
  paste0(working_directory, "plots/", "entropy_viable_phenotypes_step-1.png")
)
```

### 2-step mutants

```{r}
ggplot(
    ls2_run_summary_data,
    aes(
      x=env_chg_rate_label,
      y=entropy_viable_phenotypes,
      fill=env_condition
    )
  ) +
  geom_flat_violin(
    position = position_nudge(x = .2, y = 0),
    alpha = .8,
    adjust=1.5
  ) +
  geom_point(
    mapping=aes(color=env_condition),
    position = position_jitter(width = .15),
    size = .5,
    alpha = 0.8
  ) +
  geom_boxplot(
    width = .1,
    outlier.shape = NA,
    alpha = 0.5
  ) +
  scale_fill_brewer(
    palette=cb_palette
  ) +
  scale_color_brewer(
    palette=cb_palette
  ) +
  facet_grid(
    COPY_MUT_PROB~env_type_label,
    scales="free_x"
  ) +
  theme(
    legend.position="none",
    axis.text=element_text(size=14),
    panel.border = element_rect(color = "grey", fill=NA, size=1.5)
  )

ggsave(
  paste0(working_directory, "plots/", "entropy_viable_phenotypes_step-2.png")
)
```

## Average distance to ancestor

### 1-step mutants

```{r}
ggplot(
    ls1_run_summary_data,
    aes(
      x=env_chg_rate_label,
      y=avg_dist_to_ancestor,
      fill=env_condition
    )
  ) +
  geom_flat_violin(
    position = position_nudge(x = .2, y = 0),
    alpha = .8,
    adjust=1.5
  ) +
  geom_point(
    mapping=aes(color=env_condition),
    position = position_jitter(width = .15),
    size = .5,
    alpha = 0.8
  ) +
  geom_boxplot(
    width = .1,
    outlier.shape = NA,
    alpha = 0.5
  ) +
  scale_fill_brewer(
    palette=cb_palette
  ) +
  scale_color_brewer(
    palette=cb_palette
  ) +
  facet_grid(
    COPY_MUT_PROB~env_type_label,
    scales="free_x"
  ) +
  theme(
    legend.position="none",
    axis.text=element_text(size=14),
    panel.border = element_rect(color = "grey", fill=NA, size=1.5)
  )

ggsave(
  paste0(working_directory, "plots/", "avg_dist_to_ancestor_step-1.png")
)
```

### 2-step mutants

```{r}
ggplot(
    ls2_run_summary_data,
    aes(
      x=env_chg_rate_label,
      y=avg_dist_to_ancestor,
      fill=env_condition
    )
  ) +
  geom_flat_violin(
    position = position_nudge(x = .2, y = 0),
    alpha = .8,
    adjust=1.5
  ) +
  geom_point(
    mapping=aes(color=env_condition),
    position = position_jitter(width = .15),
    size = .5,
    alpha = 0.8
  ) +
  geom_boxplot(
    width = .1,
    outlier.shape = NA,
    alpha = 0.5
  ) +
  scale_fill_brewer(
    palette=cb_palette
  ) +
  scale_color_brewer(
    palette=cb_palette
  ) +
  facet_grid(
    COPY_MUT_PROB~env_type_label,
    scales="free_x"
  ) +
  theme(
    legend.position="none",
    axis.text=element_text(size=14),
    panel.border = element_rect(color = "grey", fill=NA, size=1.5)
  )

ggsave(
  paste0(working_directory, "plots/", "avg_dist_to_ancestor_step-2.pdf")
)
```

## num_viable_mutants_flip_env

### 1-step mutants

```{r}
ggplot(
    ls1_run_summary_data,
    aes(
      x=env_chg_rate_label,
      y=num_viable_mutants_flip_env,
      fill=env_condition
    )
  ) +
  geom_flat_violin(
    position = position_nudge(x = .2, y = 0),
    alpha = .8,
    adjust=1.5
  ) +
  geom_point(
    mapping=aes(color=env_condition),
    position = position_jitter(width = .15),
    size = .5,
    alpha = 0.8
  ) +
  geom_boxplot(
    width = .1,
    outlier.shape = NA,
    alpha = 0.5
  ) +
  scale_fill_brewer(
    palette=cb_palette
  ) +
  scale_color_brewer(
    palette=cb_palette
  ) +
  facet_grid(
    COPY_MUT_PROB~env_type_label,
    scales="free_x"
  ) +
  theme(
    legend.position="none",
    axis.text=element_text(size=14),
    panel.border = element_rect(color = "grey", fill=NA, size=1.5)
  )

ggsave(
  paste0(working_directory, "plots/", "num_viable_mutants_flip_env_step-1.pdf")
)
```

### 2-step mutants

## avg_match_chg_toward_env_b

### 1-step mutants

```{r}
ggplot(
    ls1_run_summary_data,
    aes(
      x=env_chg_rate_label,
      y=avg_match_chg_toward_env_b,
      fill=env_condition
    )
  ) +
  geom_flat_violin(
    position = position_nudge(x = .2, y = 0),
    alpha = .8,
    adjust=1.5
  ) +
  geom_point(
    mapping=aes(color=env_condition),
    position = position_jitter(width = .15),
    size = .5,
    alpha = 0.8
  ) +
  geom_boxplot(
    width = .1,
    outlier.shape = NA,
    alpha = 0.5
  ) +
  scale_fill_brewer(
    palette=cb_palette
  ) +
  scale_color_brewer(
    palette=cb_palette
  ) +
  facet_grid(
    COPY_MUT_PROB~env_type_label,
    scales="free_x"
  ) +
  theme(
    legend.position="none",
    axis.text=element_text(size=14),
    panel.border = element_rect(color = "grey", fill=NA, size=1.5)
  )

ggsave(
  paste0(working_directory, "plots/", "avg_match_chg_toward_env_b_step-1.png")
)
```

### 2-step mutants

```{r}
ggplot(
    ls2_run_summary_data,
    aes(
      x=env_chg_rate_label,
      y=avg_match_chg_toward_env_b,
      fill=env_condition
    )
  ) +
  geom_flat_violin(
    position = position_nudge(x = .2, y = 0),
    alpha = .8,
    adjust=1.5
  ) +
  geom_point(
    mapping=aes(color=env_condition),
    position = position_jitter(width = .15),
    size = .5,
    alpha = 0.8
  ) +
  geom_boxplot(
    width = .1,
    outlier.shape = NA,
    alpha = 0.5
  ) +
  scale_fill_brewer(
    palette=cb_palette
  ) +
  scale_color_brewer(
    palette=cb_palette
  ) +
  facet_grid(
    COPY_MUT_PROB~env_type_label,
    scales="free_x"
  ) +
  theme(
    legend.position="none",
    axis.text=element_text(size=14),
    panel.border = element_rect(color = "grey", fill=NA, size=1.5)
  )

ggsave(
  paste0(working_directory, "plots/", "avg_match_chg_toward_env_b_step-2.pdf")
)
```

## num_viable_mutants_improve_env_b

### 1-step mutants

```{r}
ggplot(
    ls1_run_summary_data,
    aes(
      x=env_chg_rate_label,
      y=num_viable_mutants_improve_env_b,
      fill=env_condition
    )
  ) +
  geom_flat_violin(
    position = position_nudge(x = .2, y = 0),
    alpha = .8,
    adjust=1.5
  ) +
  geom_point(
    mapping=aes(color=env_condition),
    position = position_jitter(width = .15),
    size = .5,
    alpha = 0.8
  ) +
  geom_boxplot(
    width = .1,
    outlier.shape = NA,
    alpha = 0.5
  ) +
  scale_fill_brewer(
    palette=cb_palette
  ) +
  scale_color_brewer(
    palette=cb_palette
  ) +
  facet_grid(
    COPY_MUT_PROB~env_type_label,
    scales="free_x"
  ) +
  theme(
    legend.position="none",
    axis.text=element_text(size=14),
    panel.border = element_rect(color = "grey", fill=NA, size=1.5)
  )

ggsave(
  paste0(working_directory, "plots/", "num_viable_mutants_improve_env_b_step-1.png")
)
```

### 2-step mutants

```{r}
ggplot(
    ls2_run_summary_data,
    aes(
      x=env_chg_rate_label,
      y=num_viable_mutants_improve_env_b,
      fill=env_condition
    )
  ) +
  geom_flat_violin(
    position = position_nudge(x = .2, y = 0),
    alpha = .8,
    adjust=1.5
  ) +
  geom_point(
    mapping=aes(color=env_condition),
    position = position_jitter(width = .15),
    size = .5,
    alpha = 0.8
  ) +
  geom_boxplot(
    width = .1,
    outlier.shape = NA,
    alpha = 0.5
  ) +
  scale_fill_brewer(
    palette=cb_palette
  ) +
  scale_color_brewer(
    palette=cb_palette
  ) +
  facet_grid(
    COPY_MUT_PROB~env_type_label,
    scales="free_x"
  ) +
  theme(
    legend.position="none",
    axis.text=element_text(size=14),
    panel.border = element_rect(color = "grey", fill=NA, size=1.5)
  )

ggsave(
  paste0(working_directory, "plots/", "num_viable_mutants_improve_env_b_step-2.pdf")
)
```

## Number of viable mutants that gain tasks

### 1-step mutants

```{r}
ggplot(
    ls1_run_summary_data,
    aes(
      x=env_chg_rate_label,
      y=num_viable_mutants_gain_tasks,
      fill=env_condition
    )
  ) +
  geom_flat_violin(
    position = position_nudge(x = .2, y = 0),
    alpha = .8,
    adjust=1.5
  ) +
  geom_point(
    mapping=aes(color=env_condition),
    position = position_jitter(width = .15),
    size = .5,
    alpha = 0.8
  ) +
  geom_boxplot(
    width = .1,
    outlier.shape = NA,
    alpha = 0.5
  ) +
  scale_fill_brewer(
    palette=cb_palette
  ) +
  scale_color_brewer(
    palette=cb_palette
  ) +
  facet_grid(
    COPY_MUT_PROB~env_type_label,
    scales="free_x"
  ) +
  theme(
    legend.position="none",
    axis.text=element_text(size=14),
    panel.border = element_rect(color = "grey", fill=NA, size=1.5)
  )

ggsave(
  paste0(working_directory, "plots/", "num_viable_mutants_gain_tasks_step-1.png")
)
```

### 2-step mutants

```{r}
ggplot(
    ls2_run_summary_data,
    aes(
      x=env_chg_rate_label,
      y=num_viable_mutants_gain_tasks,
      fill=env_condition
    )
  ) +
  geom_flat_violin(
    position = position_nudge(x = .2, y = 0),
    alpha = .8,
    adjust=1.5
  ) +
  geom_point(
    mapping=aes(color=env_condition),
    position = position_jitter(width = .15),
    size = .5,
    alpha = 0.8
  ) +
  geom_boxplot(
    width = .1,
    outlier.shape = NA,
    alpha = 0.5
  ) +
  scale_fill_brewer(
    palette=cb_palette
  ) +
  scale_color_brewer(
    palette=cb_palette
  ) +
  facet_grid(
    COPY_MUT_PROB~env_type_label,
    scales="free_x"
  ) +
  theme(
    legend.position="none",
    axis.text=element_text(size=14),
    panel.border = element_rect(color = "grey", fill=NA, size=1.5)
  )

ggsave(
  paste0(working_directory, "plots/", "num_viable_mutants_gain_tasks_step-2.png")
)
```

## num_viable_mutants_gain_multiple_tasks

### 1-step mutants

```{r}
ggplot(
    ls1_run_summary_data,
    aes(
      x=env_chg_rate_label,
      y=num_viable_mutants_gain_multiple_tasks,
      fill=env_condition
    )
  ) +
  geom_flat_violin(
    position = position_nudge(x = .2, y = 0),
    alpha = .8,
    adjust=1.5
  ) +
  geom_point(
    mapping=aes(color=env_condition),
    position = position_jitter(width = .15),
    size = .5,
    alpha = 0.8
  ) +
  geom_boxplot(
    width = .1,
    outlier.shape = NA,
    alpha = 0.5
  ) +
  scale_fill_brewer(
    palette=cb_palette
  ) +
  scale_color_brewer(
    palette=cb_palette
  ) +
  scale_y_continuous(
    # trans=log10_trans()
    trans=pseudo_log_trans(sigma=1,base=10),
    breaks=c(0, 10, 100, 1000)
  ) +
  facet_grid(
    COPY_MUT_PROB~env_type_label,
    scales="free_x"
  ) +
  theme(
    legend.position="none",
    axis.text=element_text(size=14),
    panel.border = element_rect(color = "grey", fill=NA, size=1.5)
  )

ggsave(
  paste0(working_directory, "plots/", "num_viable_mutants_gain_multiple_tasks_step-1.png")
)
```

### 2-step mutants


```{r}
ggplot(
    ls2_run_summary_data,
    aes(
      x=env_chg_rate_label,
      y=num_viable_mutants_gain_multiple_tasks,
      fill=env_condition
    )
  ) +
  geom_flat_violin(
    position = position_nudge(x = .2, y = 0),
    alpha = .8,
    adjust=1.5
  ) +
  geom_point(
    mapping=aes(color=env_condition),
    position = position_jitter(width = .15),
    size = .5,
    alpha = 0.8
  ) +
  geom_boxplot(
    width = .1,
    outlier.shape = NA,
    alpha = 0.5
  ) +
  scale_fill_brewer(
    palette=cb_palette
  ) +
  scale_color_brewer(
    palette=cb_palette
  ) +
  scale_y_continuous(
    # trans=log10_trans()
    trans=pseudo_log_trans(sigma=1,base=10),
    breaks=c(0, 10, 100, 1000, 10000, 100000)
  ) +
  facet_grid(
    COPY_MUT_PROB~env_type_label,
    scales="free_x"
  ) +
  theme(
    legend.position="none",
    axis.text=element_text(size=14),
    panel.border = element_rect(color = "grey", fill=NA, size=1.5)
  )

ggsave(
  paste0(working_directory, "plots/", "num_viable_mutants_gain_multiple_tasks_step-2.png")
)
```

## Number of viable mutants that lose tasks

### 1-step mutants

```{r}
ggplot(
    ls1_run_summary_data,
    aes(
      x=env_chg_rate_label,
      y=num_viable_mutants_lose_tasks,
      fill=env_condition
    )
  ) +
  geom_flat_violin(
    position = position_nudge(x = .2, y = 0),
    alpha = .8,
    adjust=1.5
  ) +
  geom_point(
    mapping=aes(color=env_condition),
    position = position_jitter(width = .15),
    size = .5,
    alpha = 0.8
  ) +
  geom_boxplot(
    width = .1,
    outlier.shape = NA,
    alpha = 0.5
  ) +
  scale_fill_brewer(
    palette=cb_palette
  ) +
  scale_color_brewer(
    palette=cb_palette
  ) +
  facet_grid(
    COPY_MUT_PROB~env_type_label,
    scales="free_x"
  ) +
  theme(
    legend.position="none",
    axis.text=element_text(size=14),
    panel.border = element_rect(color = "grey", fill=NA, size=1.5)
  )

ggsave(
  paste0(working_directory, "plots/", "num_viable_mutants_lose_tasks_step-1.png")
)
```

### 2-step mutants

```{r}
ggplot(
    ls2_run_summary_data,
    aes(
      x=env_chg_rate_label,
      y=num_viable_mutants_lose_tasks,
      fill=env_condition
    )
  ) +
  geom_flat_violin(
    position = position_nudge(x = .2, y = 0),
    alpha = .8,
    adjust=1.5
  ) +
  geom_point(
    mapping=aes(color=env_condition),
    position = position_jitter(width = .15),
    size = .5,
    alpha = 0.8
  ) +
  geom_boxplot(
    width = .1,
    outlier.shape = NA,
    alpha = 0.5
  ) +
  scale_fill_brewer(
    palette=cb_palette
  ) +
  scale_color_brewer(
    palette=cb_palette
  ) +
  facet_grid(
    COPY_MUT_PROB~env_type_label,
    scales="free_x"
  ) +
  theme(
    legend.position="none",
    axis.text=element_text(size=14),
    panel.border = element_rect(color = "grey", fill=NA, size=1.5)
  )

ggsave(
  paste0(working_directory, "plots/", "num_viable_mutants_lose_tasks_step-2.png")
)
```

## num_viable_mutants_lose_multiple_tasks

### 1-step mutants

```{r}
ggplot(
    ls1_run_summary_data,
    aes(
      x=env_chg_rate_label,
      y=num_viable_mutants_lose_multiple_tasks,
      fill=env_condition
    )
  ) +
  geom_flat_violin(
    position = position_nudge(x = .2, y = 0),
    alpha = .8,
    adjust=1.5
  ) +
  geom_point(
    mapping=aes(color=env_condition),
    position = position_jitter(width = .15),
    size = .5,
    alpha = 0.8
  ) +
  geom_boxplot(
    width = .1,
    outlier.shape = NA,
    alpha = 0.5
  ) +
  scale_fill_brewer(
    palette=cb_palette
  ) +
  scale_color_brewer(
    palette=cb_palette
  ) +
  facet_grid(
    COPY_MUT_PROB~env_type_label,
    scales="free_x"
  ) +
  theme(
    legend.position="none",
    axis.text=element_text(size=14),
    panel.border = element_rect(color = "grey", fill=NA, size=1.5)
  )

ggsave(
  paste0(working_directory, "plots/", "num_viable_mutants_lose_multiple_tasks_step-1.png")
)
```

### 2-step mutants

```{r}
ggplot(
    ls2_run_summary_data,
    aes(
      x=env_chg_rate_label,
      y=num_viable_mutants_lose_multiple_tasks,
      fill=env_condition
    )
  ) +
  geom_flat_violin(
    position = position_nudge(x = .2, y = 0),
    alpha = .8,
    adjust=1.5
  ) +
  geom_point(
    mapping=aes(color=env_condition),
    position = position_jitter(width = .15),
    size = .5,
    alpha = 0.8
  ) +
  geom_boxplot(
    width = .1,
    outlier.shape = NA,
    alpha = 0.5
  ) +
  scale_fill_brewer(
    palette=cb_palette
  ) +
  scale_color_brewer(
    palette=cb_palette
  ) +
  facet_grid(
    COPY_MUT_PROB~env_type_label,
    scales="free_x"
  ) +
  theme(
    legend.position="none",
    axis.text=element_text(size=14),
    panel.border = element_rect(color = "grey", fill=NA, size=1.5)
  )

ggsave(
  paste0(working_directory, "plots/", "num_viable_mutants_lose_multiple_tasks_step-2.pdf")
)
```

## Average number of tasks lost

(when tasks are lost)

### 1-step mutants
```{r}
ggplot(
    ls1_run_summary_data,
    aes(
      x=env_chg_rate_label,
      y=avg_num_tasks_lost,
      fill=env_condition
    )
  ) +
  geom_flat_violin(
    position = position_nudge(x = .2, y = 0),
    alpha = .8,
    adjust=1.5
  ) +
  geom_point(
    mapping=aes(color=env_condition),
    position = position_jitter(width = .15),
    size = .5,
    alpha = 0.8
  ) +
  geom_boxplot(
    width = .1,
    outlier.shape = NA,
    alpha = 0.5
  ) +
  scale_fill_brewer(
    palette=cb_palette
  ) +
  scale_color_brewer(
    palette=cb_palette
  ) +
  facet_grid(
    COPY_MUT_PROB~env_type_label,
    scales="free_x"
  ) +
  theme(
    legend.position="none",
    axis.text=element_text(size=14),
    panel.border = element_rect(color = "grey", fill=NA, size=1.5)
  )

ggsave(
  paste0(working_directory, "plots/", "avg_num_tasks_lost_step-1.png")
)
```

### 2-step mutants

```{r}
ggplot(
    ls2_run_summary_data,
    aes(
      x=env_chg_rate_label,
      y=avg_num_tasks_lost,
      fill=env_condition
    )
  ) +
  geom_flat_violin(
    position = position_nudge(x = .2, y = 0),
    alpha = .8,
    adjust=1.5
  ) +
  geom_point(
    mapping=aes(color=env_condition),
    position = position_jitter(width = .15),
    size = .5,
    alpha = 0.8
  ) +
  geom_boxplot(
    width = .1,
    outlier.shape = NA,
    alpha = 0.5
  ) +
  scale_fill_brewer(
    palette=cb_palette
  ) +
  scale_color_brewer(
    palette=cb_palette
  ) +
  facet_grid(
    COPY_MUT_PROB~env_type_label,
    scales="free_x"
  ) +
  theme(
    legend.position="none",
    axis.text=element_text(size=14),
    panel.border = element_rect(color = "grey", fill=NA, size=1.5)
  )

ggsave(
  paste0(working_directory, "plots/", "avg_num_tasks_lost_step-2.pdf")
)
```

## Total NPMI

total_npmi

### 1-step mutants
```{r}
ggplot(
    ls1_run_summary_data,
    aes(
      x=env_chg_rate_label,
      y=total_npmi,
      fill=env_condition
    )
  ) +
  geom_flat_violin(
    position = position_nudge(x = .2, y = 0),
    alpha = .8,
    adjust=1.5
  ) +
  geom_point(
    mapping=aes(color=env_condition),
    position = position_jitter(width = .15),
    size = .5,
    alpha = 0.8
  ) +
  geom_boxplot(
    width = .1,
    outlier.shape = NA,
    alpha = 0.5
  ) +
  geom_hline(
    yintercept=0,
    linetype="dashed",
    size=0.5
  ) +
  scale_fill_brewer(
    palette=cb_palette
  ) +
  scale_color_brewer(
    palette=cb_palette
  ) +
  facet_grid(
    COPY_MUT_PROB~env_type_label,
    scales="free_x"
  ) +
  theme(
    legend.position="none",
    axis.text=element_text(size=14),
    panel.border = element_rect(color = "grey", fill=NA, size=1.5)
  )

ggsave(
  paste0(working_directory, "plots/", "total_npmi_step-1.png")
)
```

### 2-step mutants

```{r}
ggplot(
    ls2_run_summary_data,
    aes(
      x=env_chg_rate_label,
      y=total_npmi,
      fill=env_condition
    )
  ) +
  geom_flat_violin(
    position = position_nudge(x = .2, y = 0),
    alpha = .8,
    adjust=1.5
  ) +
  geom_point(
    mapping=aes(color=env_condition),
    position = position_jitter(width = .15),
    size = .5,
    alpha = 0.8
  ) +
  geom_boxplot(
    width = .1,
    outlier.shape = NA,
    alpha = 0.5
  ) +
  geom_hline(
    yintercept=0,
    linetype="dashed",
    size=0.5
  ) +
  scale_fill_brewer(
    palette=cb_palette
  ) +
  scale_color_brewer(
    palette=cb_palette
  ) +
  facet_grid(
    COPY_MUT_PROB~env_type_label,
    scales="free_x"
  ) +
  theme(
    legend.position="none",
    axis.text=element_text(size=14),
    panel.border = element_rect(color = "grey", fill=NA, size=1.5)
  )

ggsave(
  paste0(working_directory, "plots/", "total_npmi_step-2.png")
)
```

## Total unexpected NPMI

### 1-step mutants

```{r}
ggplot(
    ls1_run_summary_data,
    aes(
      x=env_chg_rate_label,
      y=unexpected_npmi,
      fill=env_condition
    )
  ) +
  geom_flat_violin(
    position = position_nudge(x = .2, y = 0),
    alpha = .8,
    adjust=1.5
  ) +
  geom_point(
    mapping=aes(color=env_condition),
    position = position_jitter(width = .15),
    size = .5,
    alpha = 0.8
  ) +
  geom_boxplot(
    width = .1,
    outlier.shape = NA,
    alpha = 0.5
  ) +
  geom_hline(
    yintercept=0,
    linetype="dashed",
    size=0.5
  ) +
  scale_fill_brewer(
    palette=cb_palette
  ) +
  scale_color_brewer(
    palette=cb_palette
  ) +
  facet_grid(
    COPY_MUT_PROB~env_type_label,
    scales="free_x"
  ) +
  theme(
    legend.position="none",
    axis.text=element_text(size=14),
    panel.border = element_rect(color = "grey", fill=NA, size=1.5)
  )

ggsave(
  paste0(working_directory, "plots/", "unexpected_npmi_step-1.pdf")
)
```

### 2-step mutants

```{r}
ggplot(
    ls2_run_summary_data,
    aes(
      x=env_chg_rate_label,
      y=unexpected_npmi,
      fill=env_condition
    )
  ) +
  geom_flat_violin(
    position = position_nudge(x = .2, y = 0),
    alpha = .8,
    adjust=1.5
  ) +
  geom_point(
    mapping=aes(color=env_condition),
    position = position_jitter(width = .15),
    size = .5,
    alpha = 0.8
  ) +
  geom_boxplot(
    width = .1,
    outlier.shape = NA,
    alpha = 0.5
  ) +
  geom_hline(
    yintercept=0,
    linetype="dashed",
    size=0.5
  ) +
  scale_fill_brewer(
    palette=cb_palette
  ) +
  scale_color_brewer(
    palette=cb_palette
  ) +
  facet_grid(
    COPY_MUT_PROB~env_type_label,
    scales="free_x"
  ) +
  theme(
    legend.position="none",
    axis.text=element_text(size=14),
    panel.border = element_rect(color = "grey", fill=NA, size=1.5)
  )

ggsave(
  paste0(working_directory, "plots/", "unexpected_npmi_step-2.pdf")
)
```

## Total expected NPMI

### 1-step mutants

```{r}
ggplot(
    ls1_run_summary_data,
    aes(
      x=env_chg_rate_label,
      y=expected_npmi,
      fill=env_condition
    )
  ) +
  geom_flat_violin(
    position = position_nudge(x = .2, y = 0),
    alpha = .8,
    adjust=1.5
  ) +
  geom_point(
    mapping=aes(color=env_condition),
    position = position_jitter(width = .15),
    size = .5,
    alpha = 0.8
  ) +
  geom_boxplot(
    width = .1,
    outlier.shape = NA,
    alpha = 0.5
  ) +
  geom_hline(
    yintercept=0,
    linetype="dashed",
    size=0.5
  ) +
  scale_fill_brewer(
    palette=cb_palette
  ) +
  scale_color_brewer(
    palette=cb_palette
  ) +
  facet_grid(
    COPY_MUT_PROB~env_type_label,
    scales="free_x"
  ) +
  theme(
    legend.position="none",
    axis.text=element_text(size=14),
    panel.border = element_rect(color = "grey", fill=NA, size=1.5)
  )

ggsave(
  paste0(working_directory, "plots/", "expected_npmi_step-1.pdf")
)
```

### 2-step mutants

```{r}
ggplot(
    ls2_run_summary_data,
    aes(
      x=env_chg_rate_label,
      y=expected_npmi,
      fill=env_condition
    )
  ) +
  geom_flat_violin(
    position = position_nudge(x = .2, y = 0),
    alpha = .8,
    adjust=1.5
  ) +
  geom_point(
    mapping=aes(color=env_condition),
    position = position_jitter(width = .15),
    size = .5,
    alpha = 0.8
  ) +
  geom_boxplot(
    width = .1,
    outlier.shape = NA,
    alpha = 0.5
  ) +
  geom_hline(
    yintercept=0,
    linetype="dashed",
    size=0.5
  ) +
  scale_fill_brewer(
    palette=cb_palette
  ) +
  scale_color_brewer(
    palette=cb_palette
  ) +
  facet_grid(
    COPY_MUT_PROB~env_type_label,
    scales="free_x"
  ) +
  theme(
    legend.position="none",
    axis.text=element_text(size=14),
    panel.border = element_rect(color = "grey", fill=NA, size=1.5)
  )

ggsave(
  paste0(working_directory, "plots/", "expected_npmi_step-2.pdf")
)
```

## Pointwise mutual information matrices

### 1-step mutants

```{r}
ggplot(
    ls1_cooccur_data,
    aes(
      x=task_1_id,
      y=task_2_id,
      fill=npmi_avg
    )
  ) +
  geom_tile() +
  scale_fill_distiller(
    palette = "RdBu",
    limits=c(-1.0, 1.0),
    breaks=c(-1, -0.5, 0.0, 0.5, 1.0)
  ) +
  facet_grid(
    env_condition~COPY_MUT_PROB
  ) +
  ggtitle("One-step Mutants") +
  theme(
    legend.position="bottom",
    strip.text.y=element_text(size=10),
    legend.key.width=unit(3, "cm")
  )
ggsave(
  paste0(working_directory, "plots/", "npmi_matrices_step-1.png"),
  height=15,
  width=12
)
```

### 2-step mutants

```{r}
ggplot(
    ls2_cooccur_data,
    aes(
      x=task_1_id,
      y=task_2_id,
      fill=npmi_avg
    )
  ) +
  geom_tile() +
  scale_fill_distiller(
    palette = "RdBu",
    limits=c(-1.0, 1.0),
    breaks=c(-1, -0.5, 0.0, 0.5, 1.0)
  ) +
  facet_grid(
    env_condition~COPY_MUT_PROB
  ) +
  ggtitle("Two-step Mutants") +
  theme(
    legend.position="bottom",
    strip.text.y=element_text(size=10),
    legend.key.width=unit(3, "cm")
  )
ggsave(
  paste0(working_directory, "plots/", "npmi_matrices_step-2.png"),
  height=15,
  width=12
)
```

## Distribution of mutant phenotypes

### 1-step mutants

```{r}
ggplot(
    # filter(ls1_phen_dists_data, env_condition=="env-consta"),
    ls1_phen_dists_data,
    aes(
      x=rep_id,
      y=count_env_a,
      fill=distance
    )
  ) +
  geom_bar(position="stack", stat="identity") +
  # scale_fill_viridis(discrete=TRUE, direction=-1) +
  scale_fill_manual(
    name="Distance to ENV-A",
    values=c("#000000", viridis(n=7, alpha=1, direction=-1))
  ) +
  facet_grid(
    env_condition~COPY_MUT_PROB,
    scales="free_x"
  ) +
  theme(
    legend.position="bottom",
    axis.text.x=element_text(size=10)
  )
ggsave(
  paste0(working_directory, "plots/", "mutant_phen_dist_env_a_step-1.pdf"),
  width=15,
  height=18
)

```

### 2-step mutants

```{r}
ggplot(
    # filter(ls1_phen_dists_data, env_condition=="env-consta"),
    # filter(ls2_phen_dists_data, distance==6),
    # filter(ls2_phen_dists_data, dom_match_score_env_a==6),
    # ls2_phen_dists_data,
    aes(
      x=rep_id,
      y=count_env_a,
      fill=distance
    )
  ) +
  geom_bar(position="stack", stat="identity") +
  # scale_fill_viridis(discrete=TRUE, direction=-1) +
  scale_fill_manual(
    name="Distance to ENV-A",
    values=c("#000000", viridis(n=7, alpha=1, direction=-1))
  ) +
  facet_grid(
    env_condition~COPY_MUT_PROB,
    scales="free_x"
  ) +
  theme(
    legend.position="bottom",
    axis.text.x=element_text(size=10)
  )
ggsave(
  paste0(working_directory, "plots/", "mutant_phen_dist_env_a_step-2.pdf"),
  width=15,
  height=18
)
# ggsave(
#   paste0(working_directory, "plots/", "mutant_phen_dist_env_a_step-2.png"),
#   width=15,
#   height=18
# )
```

## Distance N away from env-A

```{r}
ggplot(
    filter(ls1_phen_dists_data, (distance==0) & env_chg_rate_label!="none-b"),
    aes(
      x=env_chg_rate_label,
      y=count_env_b,
      fill=env_condition
    )
  ) +
  geom_flat_violin(
    position = position_nudge(x = .2, y = 0),
    alpha = .8,
    adjust=1.5
  ) +
  geom_point(
    mapping=aes(color=env_condition),
    position = position_jitter(width = .15),
    size = .5,
    alpha = 0.8
  ) +
  geom_boxplot(
    width = .1,
    outlier.shape = NA,
    alpha = 0.5
  ) +
  geom_hline(
    yintercept=0,
    linetype="dashed",
    size=0.5
  ) +
  scale_fill_brewer(
    palette=cb_palette
  ) +
  scale_color_brewer(
    palette=cb_palette
  ) +
  scale_y_continuous(
    trans=pseudo_log_trans(sigma=1,base=10),
    breaks=c(0, 10, 100, 1000, 10000, 100000)
  ) +
  facet_grid(
    COPY_MUT_PROB~env_type_label,
    scales="free_x"
  ) +
  theme(
    legend.position="none",
    axis.text=element_text(size=14),
    panel.border = element_rect(color = "grey", fill=NA, size=1.5)
  )

ggsave(
  paste0(working_directory, "plots/", "mutants_dist-6_env-a_step-1.pdf")
)
```

```{r}
ggplot(
    filter(
      ls2_phen_dists_data,
      (distance==0) & env_chg_rate_label!="none-b" & dom_match_score_env_a==6
    ),
    aes(
      x=env_chg_rate_label,
      y=count_env_b,
      fill=env_condition
    )
  ) +
  geom_flat_violin(
    position = position_nudge(x = .2, y = 0),
    alpha = .8,
    adjust=1.5
  ) +
  geom_point(
    mapping=aes(color=env_condition),
    position = position_jitter(width = .15),
    size = .5,
    alpha = 0.8
  ) +
  geom_boxplot(
    width = .1,
    outlier.shape = NA,
    alpha = 0.5
  ) +
  geom_hline(
    yintercept=0,
    linetype="dashed",
    size=0.5
  ) +
  scale_fill_brewer(
    palette=cb_palette
  ) +
  scale_color_brewer(
    palette=cb_palette
  ) +
  scale_y_continuous(
    trans=pseudo_log_trans(sigma=1,base=10),
    breaks=c(0, 10, 100, 1000, 10000, 100000)
  ) +
  facet_grid(
    COPY_MUT_PROB~env_type_label,
    scales="free_x"
  ) +
  theme(
    legend.position="none",
    axis.text=element_text(size=14),
    panel.border = element_rect(color = "grey", fill=NA, size=1.5)
  )

ggsave(
  paste0(working_directory, "plots/", "mutants_dist-6_env-a_step-2.pdf")
)
```

```{r}
ggplot(
    filter(
      ls2_phen_dists_data,
      (distance==6) & env_chg_rate_label!="none-b" & dom_match_score_env_a==6
    ),
    aes(
      x=env_chg_rate_label,
      y=count_env_b,
      fill=env_condition
    )
  ) +
  geom_flat_violin(
    position = position_nudge(x = .2, y = 0),
    alpha = .8,
    adjust=1.5
  ) +
  geom_point(
    mapping=aes(color=env_condition),
    position = position_jitter(width = .15),
    size = .5,
    alpha = 0.8
  ) +
  geom_boxplot(
    width = .1,
    outlier.shape = NA,
    alpha = 0.5
  ) +
  geom_hline(
    yintercept=0,
    linetype="dashed",
    size=0.5
  ) +
  scale_fill_brewer(
    palette=cb_palette
  ) +
  scale_color_brewer(
    palette=cb_palette
  ) +
  # scale_y_continuous(
  #   trans=pseudo_log_trans(sigma=1,base=10),
  #   breaks=c(0, 10, 100, 1000, 10000, 100000)
  # ) +
  facet_grid(
    # COPY_MUT_PROB~env_type_label,
    env_type_label~COPY_MUT_PROB,
    scales="free_x"
  ) +
  theme(
    legend.position="none",
    axis.text=element_text(size=14),
    panel.border = element_rect(color = "grey", fill=NA, size=1.5)
  )

ggsave(
  paste0(working_directory, "plots/", "mutants_dist-0_env-a_step-2.pdf")
)
```

## Task toggle count distribution

### 1-step mutants

```{r}
ggplot(
    ls1_task_toggle_data,
    # filter(ls1_task_toggle_data, COPY_MUT_PROB==0.001 & env_condition%in%focal_envs),
    aes(
      x=rep_id,
      y=num_mutants,
      fill=num_tasks_toggled
    )
  ) +
  geom_bar(position="stack", stat="identity") +
  # scale_fill_viridis(discrete=TRUE, direction=-1) +
  scale_fill_manual(
    name="Distance to ENV-A",
    values=c("#000000", viridis(n=7, alpha=1, direction=-1))
  ) +
  facet_grid(
    env_condition~COPY_MUT_PROB,
    scales="free_x"
  ) +
  theme(
    legend.position="bottom",
    axis.text.x=element_text(size=10)
  )
ggsave(
  paste0(working_directory, "plots/", "num_tasks_toggled_dist_step-1.pdf"),
  width=15,
  height=18
)
```

```{r}
ggplot(
    filter(
      ls1_task_toggle_data,
      (num_tasks_toggled==0)
    ),
    aes(
      x=env_chg_rate_label,
      y=prop_of_viable,
      # y=num_mutants,
      fill=env_condition
    )
  ) +
  geom_flat_violin(
    position = position_nudge(x = .2, y = 0),
    alpha = .8,
    adjust=1.5
  ) +
  geom_point(
    mapping=aes(color=env_condition),
    position = position_jitter(width = .15),
    size = .5,
    alpha = 0.8
  ) +
  geom_boxplot(
    width = .1,
    outlier.shape = NA,
    alpha = 0.5
  ) +
  geom_hline(
    yintercept=0,
    linetype="dashed",
    size=0.5
  ) +
  scale_fill_brewer(
    palette=cb_palette
  ) +
  scale_color_brewer(
    palette=cb_palette
  ) +
  # scale_y_continuous(
  #   trans=pseudo_log_trans(sigma=1,base=10),
  #   breaks=c(0, 10, 100, 1000, 10000, 100000)
  # ) +
  facet_grid(
    COPY_MUT_PROB~env_type_label,
    # env_type_label~COPY_MUT_PROB,
    scales="free_x"
  ) +
  theme(
    legend.position="none",
    axis.text=element_text(size=14),
    panel.border = element_rect(color = "grey", fill=NA, size=1.5)
  )
```

## Manuscript (draft) Figures

### Environmental change influences mutational landscape

```{r}
focal_mut_rate <- 0.001
focal_envs <- c(
  "env-consta",
  "env-constb",
  "env-cycling_rate-300",
  "env-random_rate-300"
)
env_breaks<-c("consta", "constb", "cycling", "random")
env_labels<-c("Const-A", "Const-B", "Cyclic", "Random")

env_facets <- c(
  "env-consta"="Const-A",
  "env-constb"="Const-B",
  "env-cycling_rate-300"="Cyclic",
  "env-random_rate-300"="Random"
)
env_facet_labeller <- function(variable, value) {
  return(env_facets[value])
}
```

#### Total normalized pointwise mutual information

```{r}
fig_total_npmi <-
  ggplot(
    filter(
      ls2_run_summary_data,
      COPY_MUT_PROB==focal_mut_rate & env_condition%in%focal_envs
    ),
    aes(
      x=env_type,
      y=total_npmi,
      fill=env_condition
    )
  ) +
  geom_flat_violin(
    scale="area",
    position = position_nudge(x = .2, y = 0),
    alpha = .8,
    adjust=1.5
  ) +
  geom_point(
    mapping=aes(color=env_condition),
    position = position_jitter(width = .15),
    size = 1,
    alpha = 0.8
  ) +
  geom_boxplot(
    width = .1,
    outlier.shape = NA,
    alpha = 0.5
  ) +
  geom_hline(
    yintercept=0,
    linetype="dashed",
    size=0.5
  ) +
  scale_fill_brewer(
    palette=cb_palette
  ) +
  scale_color_brewer(
    palette=cb_palette
  ) +
  scale_y_continuous(
    name="Total NPMI"
  ) +
  scale_x_discrete(
    name="Environment",
    breaks=env_breaks,
    limits=env_breaks,
    labels=env_labels
  ) +
  theme(
    legend.position="none",
    axis.text=element_text(size=14)
    # panel.border = element_rect(color = "grey", fill=NA, size=1.5)
  )
```

#### Matrices

```{r}
fig_avg_nmpi_matrices <-
  ggplot(
    filter(
      ls2_cooccur_data,
      COPY_MUT_PROB==focal_mut_rate & env_condition%in%focal_envs
    ),
    aes(
      x=task_1_id,
      y=task_2_id,
      fill=npmi_avg
    )
  ) +
  geom_tile() +
  scale_y_discrete(
    "Task ID"
  ) +
  scale_x_discrete(
    "Task ID"
  ) +
  scale_fill_distiller(
    name="Avg. NPMI",
    palette = "RdBu",
    limits=c(-1.0, 1.0),
    breaks=c(-1, -0.5, 0.0, 0.5, 1.0)
  ) +
  facet_wrap(
    ~env_condition,
    labeller=as_labeller(env_facets)
  )
  # theme(
  #   legend.position="bottom",
  #   strip.text.y=element_text(size=10),
  #   legend.key.width=unit(3, "cm")
  # )
fig_avg_nmpi_matrices
```

#### Combined

```{r}
grid <- plot_grid(
  fig_total_npmi,
  fig_avg_nmpi_matrices +
    theme(
      legend.position="bottom",
      # strip.text.y=element_text(size=10),
      legend.key.width=unit(1.5, "cm")
    ),
  nrow=1,
  ncol=2,
  labels="auto",
  rel_widths = c(1, 1.2)
)
grid

ggsave(
  filename=paste0(plot_directory, "2022-03-14-npmi-figure.pdf"),
  plot=grid,
  width=12,
  height=6
  # base_height=6
  # base_asp=2
)
```

### Phenotype accessibility

```{r}
fig_num_mutants_that_flip <-
  ggplot(
    filter(
      ls2_phen_dists_data,
      ((distance==0) & env_chg_rate_label!="none-b" & dom_match_score_env_a==6) |
      (distance==6 & env_chg_rate_label=="none-b" & dom_match_score_env_a==0)
    ),
    aes(
      x=env_chg_rate_label,
      y=count_env_b,
      fill=env_condition
    )
  ) +
  # geom_flat_violin(
  #   position = position_nudge(x = .2, y = 0),
  #   alpha = .8,
  #   adjust=1.5
  # ) +
  geom_point(
    mapping=aes(color=env_condition),
    position = position_jitter(width = .15),
    size = .5,
    alpha = 0.8
  ) +
  # geom_boxplot(
  #   width = .1,
  #   outlier.shape = NA,
  #   alpha = 0.5
  # ) +
  # geom_hline(
  #   yintercept=0,
  #   linetype="dashed",
  #   size=0.5
  # ) +
  scale_fill_brewer(
    palette=cb_palette
  ) +
  scale_color_brewer(
    palette=cb_palette
  ) +
  scale_y_continuous(
    trans=pseudo_log_trans(sigma=1,base=10),
    breaks=c(0, 10, 100, 1000, 10000, 100000)
  ) +
  facet_grid(
    COPY_MUT_PROB~env_type_label,
    scales="free_x"
  ) +
  theme(
    legend.position="none",
    axis.text=element_text(size=14),
    panel.border = element_rect(color = "grey", fill=NA, size=1.5)
  )
fig_num_mutants_that_flip
```

### High mutation rate result in more robust genotypes

```{r}
focal_mut_rates <- c(0.0001, 0.001, 0.01, 0.0316)
```

#### Viability
```{r}
fig_prop_viable <-
  ggplot(
    filter(
      ls2_run_summary_data,
      COPY_MUT_PROB%in%focal_mut_rates & env_condition%in%focal_envs
    ),
    aes(
      x=COPY_MUT_PROB,
      y=prop_viable,
      fill=env_condition
    )
  ) +
  geom_flat_violin(
    position = position_nudge(x = .2, y = 0),
    scale="area",
    alpha = .8,
    adjust=1.5
  ) +
  geom_point(
    mapping=aes(color=env_condition),
    position = position_jitter(width = .15),
    size = 1,
    alpha = 0.8
  ) +
  geom_boxplot(
    width = .1,
    outlier.shape = NA,
    alpha = 0.5
  ) +
  # stat_summary(
  #   geom="line",
  #   fun="mean",
  #   group=1
  # ) +
  scale_fill_brewer(
    palette=cb_palette
  ) +
  scale_color_brewer(
    palette=cb_palette
  ) +
  scale_x_discrete(
    name="Mutation rate",
  ) +
  scale_y_continuous(
    name="Proportion viable"
  ) +
  facet_wrap(
    ~env_condition,
    nrow=1,
    labeller=as_labeller(env_facets)
  ) +
  theme(
    legend.position="none",
    axis.text=element_text(size=14)
  )
fig_prop_viable
```

#### Task phenotype

```{r}
fig_phenotypic_profile_robustness <-
  ggplot(
    filter(
      ls1_task_toggle_data,
      (num_tasks_toggled==0) &
      COPY_MUT_PROB%in%focal_mut_rates & env_condition%in%focal_envs
    ),
    aes(
      x=COPY_MUT_PROB,
      y=prop_of_viable,
      # y=num_mutants,
      fill=env_condition
    )
  ) +
  geom_flat_violin(
    position = position_nudge(x = .2, y = 0),
    alpha = .8,
    adjust=1.5
  ) +
  geom_point(
    mapping=aes(color=env_condition),
    position = position_jitter(width = .15),
    size = 1,
    alpha = 0.8
  ) +
  geom_boxplot(
    width = .1,
    outlier.shape = NA,
    alpha = 0.5
  ) +
  # geom_hline(
  #   yintercept=0,
  #   linetype="dashed",
  #   size=0.5
  # ) +
  scale_fill_brewer(
    palette=cb_palette
  ) +
  scale_color_brewer(
    palette=cb_palette
  ) +
  scale_y_continuous(
    name="Proportion viable with same phenotype"
  ) +
  scale_x_discrete(
    name="Mutation rate"
  ) +
  facet_wrap(
    ~env_condition,
    nrow=1,
    labeller=as_labeller(env_facets)
  ) +
  theme(
    legend.position="none",
    axis.text=element_text(size=14)
  )
fig_phenotypic_profile_robustness
```

#### Combined

```{r}
grid <- plot_grid(
  fig_prop_viable +
    scale_y_continuous(
      name="\nProportion viable"
    ) +
    theme(
      axis.title.x = element_blank(),
      axis.text.x = element_blank()
    ),
  fig_phenotypic_profile_robustness +
    scale_y_continuous(
      name="Proportion viable\nwith same phenotype"
    ),
  nrow=2,
  ncol=1,
  labels="auto",
  axis="r"
)
grid

ggsave(
  filename=paste0(plot_directory, "2022-03-14-robustness-figure.pdf"),
  plot=grid,
  width=12,
  height=6
  # base_height=6
  # base_asp=2
)
```