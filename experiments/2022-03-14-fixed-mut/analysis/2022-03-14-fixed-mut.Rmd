# 2022-03-14 - Fixed mutation rates

## Setup

```{r}
experiment_slug <- "2022-03-14-fixed-mut"
working_directory <- paste0("experiments/",experiment_slug,"/analysis/")
```

### Analysis dependencies

Load all required R libraries

```{r}
library(tidyverse)
library(ggplot2)
library(scales)
library(cowplot)
library(RColorBrewer)
source("https://gist.githubusercontent.com/benmarwick/2a1bb0133ff568cbe28d/raw/fb53bd97121f7f9ce947837ef1a4c65a73bffb3f/geom_flat_violin.R")
```

These analyses were knit with the following environment:

```{r}
print(version)
```

### Load data

Load summary data.

```{r}
summary_data_loc <- paste0(working_directory, "data/aggregate.csv")
summary_data <- read.csv(summary_data_loc, na.strings="NONE")

summary_data$COPY_MUT_PROB <- as.factor(
  summary_data$COPY_MUT_PROB
)
summary_data$env_chg_rate <- factor(
  summary_data$env_chg_rate,
  levels=c(
    "none",
    "30",
    "300",
    "3000"
  )
)
summary_data$env_condition <- as.factor(
  summary_data$env_condition
)
summary_data$env_type <- as.factor(
  summary_data$env_type
)

get_env_chg_rate_label <- function(env_chg_rate, env_type) {
  if (env_chg_rate == "none" && env_type=="consta") {
    return("none-a")
  } else if (env_chg_rate == "none" && env_type=="constb") {
    return("none-b")
  } else if (env_chg_rate=="30") {
    return("30")
  } else if (env_chg_rate=="300") {
    return("300")
  } else if (env_chg_rate=="3000") {
    return("3000")
  } else {
    return("unknown")
  }
}
get_env_type_label <- function(env_type) {
  if (env_type=="consta" || env_type=="constb") {
    return("const")
  } else if (env_type=="cycling") {
    return("cycling")
  } else if (env_type=="random") {
    return("random")
  }
}
get_combined_env_type_label <- function(env_type) {
  if (env_type=="consta" || env_type=="constb") {
    return("cycling+const")
  } else if (env_type=="cycling") {
    return("cycling+const")
  } else if (env_type=="random") {
    return("random")
  }
}
summary_data$env_chg_rate_label <- mapply(
  get_env_chg_rate_label,
  summary_data$env_chg_rate,
  summary_data$env_type
)
summary_data$env_chg_rate_label <- factor(
  summary_data$env_chg_rate_label,
  levels=c(
    "none-a",
    "none-b",
    "30",
    "300",
    "3000"
  )
)
summary_data$env_type_label <- mapply(
  get_env_type_label,
  summary_data$env_type
)
summary_data$combined_env_type_label <- mapply(
  get_combined_env_type_label,
  summary_data$env_type
)
```

Load time series data.

```{r}
time_series_data_loc <- paste0(working_directory, "data/time_series_u0-u300000.csv")
time_series_data <- read.csv(time_series_data_loc, na.strings="NONE")

time_series_data$COPY_MUT_PROB <- as.factor(
  time_series_data$COPY_MUT_PROB
)
time_series_data$env_chg_rate <- as.factor(
  time_series_data$env_chg_rate
)
time_series_data$env_condition <- as.factor(
  time_series_data$env_condition
)
time_series_data$env_type <- as.factor(
  time_series_data$env_type
)

time_series_data$env_chg_rate_label <- mapply(
  get_env_chg_rate_label,
  time_series_data$env_chg_rate,
  time_series_data$env_type
)
time_series_data$env_chg_rate_label <- factor(
  time_series_data$env_chg_rate_label,
  levels=c(
    "none-a",
    "none-b",
    "30",
    "300",
    "3000"
  )
)
time_series_data$env_type_label <- mapply(
  get_env_type_label,
  time_series_data$env_type
)
```

Miscellaneous setup.

```{r}
# Configure our default graphing theme
theme_set(theme_cowplot())
# Palette
cb_palette <- "Set2"
alpha <- 0.05
# Create a directory to store plots
plot_directory <- paste0(working_directory, "plots/")
dir.create(plot_directory, showWarnings=FALSE)
```

## Fitness over time

```{r}
ggplot(
    time_series_data,
    aes(
      x=update,
      y=avg_fitness,
      fill=env_condition,
      color=env_condition
    )
  ) +
  stat_summary(geom="line", fun=mean) +
  stat_summary(
    geom="ribbon",
    fun.data="mean_cl_boot",
    fun.args=list(conf.int=0.95),
    alpha=0.2,
    linetype=0
  ) +
  # stat_summary(
  #   geom="ribbon",
  #   fun.min=min,
  #   fun.max=max,
  #   alpha=0.2,
  #   linetype=0
  # ) +
  scale_fill_brewer(
    palette=cb_palette
  ) +
  scale_color_brewer(
    palette=cb_palette
  ) +
  scale_y_continuous(
    trans=log10_trans()
  ) +
  facet_grid(
    COPY_MUT_PROB~env_type_label
  ) +
  theme(
    legend.position="bottom"
  )

ggsave(
  paste0(working_directory, "plots/", "avg_fitness_ot.png"),
  width=15,
  height=10
)
```

## True replication rate

### Time series

```{r}
ggplot(
    # time_series_data,
    filter(time_series_data, update < 5000),
    aes(
      x=update,
      y=avg_true_replication_rate,
      fill=env_condition,
      color=env_condition
    )
  ) +
  stat_summary(geom="line", fun=mean) +
  stat_summary(
    geom="ribbon",
    fun.data="mean_cl_boot",
    fun.args=list(conf.int=0.95),
    alpha=0.2,
    linetype=0
  ) +
  # stat_summary(
  #   geom="ribbon",
  #   fun.min=min,
  #   fun.max=max,
  #   alpha=0.2,
  #   linetype=0
  # ) +
  scale_fill_brewer(
    palette=cb_palette
  ) +
  scale_color_brewer(
    palette=cb_palette
  ) +
  scale_y_continuous(
    trans=log10_trans()
  ) +
  facet_grid(
    COPY_MUT_PROB~env_type_label
  ) +
  theme(
    legend.position="bottom"
  )

ggsave(
  paste0(working_directory, "plots/", "avg_true_replication_rate_ot-early.pdf"),
  width=15,
  height=10
)
```

```{r}
ggplot(
    time_series_data,
    # filter(time_series_data, (update%%1000)==0),
    aes(
      x=update,
      y=avg_true_replication_rate,
      fill=env_condition,
      color=env_condition
    )
  ) +
  stat_summary(geom="line", fun=mean) +
  stat_summary(
    geom="ribbon",
    fun.data="mean_cl_boot",
    fun.args=list(conf.int=0.95),
    alpha=0.2,
    linetype=0
  ) +
  # stat_summary(
  #   geom="ribbon",
  #   fun.min=min,
  #   fun.max=max,
  #   alpha=0.2,
  #   linetype=0
  # ) +
  scale_fill_brewer(
    palette=cb_palette
  ) +
  scale_color_brewer(
    palette=cb_palette
  ) +
  scale_y_continuous(
    trans=log10_trans()
  ) +
  facet_grid(
    COPY_MUT_PROB~env_type_label
  ) +
  theme(
    legend.position="bottom"
  )

ggsave(
  paste0(working_directory, "plots/", "avg_true_replication_rate_ot.pdf"),
  width=15,
  height=10
)
```

### Final

```{r}
ggplot(
    summary_data,
    aes(
      x=env_chg_rate_label,
      y=avg_true_replication_rate,
      fill=env_condition
    )
  ) +
  geom_flat_violin(
    position = position_nudge(x = .2, y = 0),
    alpha = .8,
    adjust=1.5
  ) +
  geom_point(
    mapping=aes(color=env_condition),
    position = position_jitter(width = .15),
    size = .5,
    alpha = 0.8
  ) +
  geom_boxplot(
    width = .1,
    outlier.shape = NA,
    alpha = 0.5
  ) +
  scale_fill_brewer(
    palette=cb_palette
  ) +
  scale_color_brewer(
    palette=cb_palette
  ) +
  scale_y_continuous(
    trans=log10_trans()
  ) +
  facet_grid(
    COPY_MUT_PROB~env_type_label,
    scales="free_x"
  ) +
  theme(
    legend.position="none",
    axis.text=element_text(size=14),
    # axis.text.x = element_text(angle = 90),
    panel.border = element_rect(color = "grey", fill=NA, size=1.5)
  )
ggsave(
  paste0(working_directory, "plots/", "avg_true_replication_rate.pdf")
)
```

## Dominant lineage length (genotypes)

```{r}
ggplot(
    summary_data,
    aes(
      x=env_chg_rate_label,
      y=dom_lineage_length_genotypes,
      fill=env_condition
    )
  ) +
  geom_flat_violin(
    position = position_nudge(x = .2, y = 0),
    alpha = .8,
    adjust=1.5
  ) +
  geom_point(
    mapping=aes(color=env_condition),
    position = position_jitter(width = .15),
    size = .5,
    alpha = 0.8
  ) +
  geom_boxplot(
    width = .1,
    outlier.shape = NA,
    alpha = 0.5
  ) +
  scale_fill_brewer(
    palette=cb_palette
  ) +
  scale_color_brewer(
    palette=cb_palette
  ) +
  scale_y_continuous(
    trans=log10_trans()
  ) +
  facet_grid(
    COPY_MUT_PROB~env_type_label,
    scales="free_x"
  ) +
  theme(
    legend.position="none",
    axis.text=element_text(size=14),
    # axis.text.x = element_text(angle = 90),
    panel.border = element_rect(color = "grey", fill=NA, size=1.5)
  )
ggsave(
  paste0(working_directory, "plots/", "dom_lineage_length_genotypes.pdf")
)
```

## phylo_current_phylogenetic_diversity

```{r}
ggplot(
    summary_data,
    aes(
      x=env_chg_rate_label,
      y=phylo_current_phylogenetic_diversity,
      fill=env_condition
    )
  ) +
  geom_flat_violin(
    position = position_nudge(x = .2, y = 0),
    alpha = .8,
    adjust=1.5
  ) +
  geom_point(
    mapping=aes(color=env_condition),
    position = position_jitter(width = .15),
    size = .5,
    alpha = 0.8
  ) +
  geom_boxplot(
    width = .1,
    outlier.shape = NA,
    alpha = 0.5
  ) +
  scale_fill_brewer(
    palette=cb_palette
  ) +
  scale_color_brewer(
    palette=cb_palette
  ) +
  scale_y_continuous(
    trans=log10_trans()
  ) +
  facet_grid(
    COPY_MUT_PROB~env_type_label,
    scales="free_x"
  ) +
  theme(
    legend.position="none",
    axis.text=element_text(size=14),
    # axis.text.x = element_text(angle = 90),
    panel.border = element_rect(color = "grey", fill=NA, size=1.5)
  )
ggsave(
  paste0(working_directory, "plots/", "phylo_current_phylogenetic_diversity.pdf")
)
```

## phylo_diversity

Genotypic Diversity (entropy of taxa in population).

```{r}
ggplot(
    summary_data,
    # filter(summary_data, COPY_MUT_PROB=="0.01"),
    aes(
      x=env_chg_rate_label,
      y=phylo_diversity,
      fill=env_condition
    )
  ) +
  geom_flat_violin(
    position = position_nudge(x = .2, y = 0),
    alpha = .8,
    adjust=1.5
  ) +
  geom_point(
    mapping=aes(color=env_condition),
    position = position_jitter(width = .15),
    size = .5,
    alpha = 0.8
  ) +
  geom_boxplot(
    width = .1,
    outlier.shape = NA,
    alpha = 0.5
  ) +
  scale_fill_brewer(
    palette=cb_palette
  ) +
  scale_color_brewer(
    palette=cb_palette
  ) +
  # scale_y_continuous(
  #   trans=log10_trans()
  # ) +
  facet_grid(
    COPY_MUT_PROB~env_type_label,
    scales="free"
  ) +
  theme(
    legend.position="none",
    axis.text=element_text(size=14),
    # axis.text.x = element_text(angle = 90),
    panel.border = element_rect(color = "grey", fill=NA, size=1.5)
  )
ggsave(
  paste0(working_directory, "plots/", "genetic_diversity.png")
)
```

## phylo_mean_pairwise_distance

```{r}
ggplot(
    summary_data,
    aes(
      x=env_chg_rate_label,
      y=phylo_mean_pairwise_distance,
      fill=env_condition
    )
  ) +
  geom_flat_violin(
    position = position_nudge(x = .2, y = 0),
    alpha = .8,
    adjust=1.5
  ) +
  geom_point(
    mapping=aes(color=env_condition),
    position = position_jitter(width = .15),
    size = .5,
    alpha = 0.8
  ) +
  geom_boxplot(
    width = .1,
    outlier.shape = NA,
    alpha = 0.5
  ) +
  scale_fill_brewer(
    palette=cb_palette
  ) +
  scale_color_brewer(
    palette=cb_palette
  ) +
  scale_y_continuous(
    trans=log10_trans()
  ) +
  facet_grid(
    COPY_MUT_PROB~env_type_label,
    scales="free"
  ) +
  theme(
    legend.position="none",
    axis.text=element_text(size=14),
    panel.border = element_rect(color = "grey", fill=NA, size=1.5)
  )
ggsave(
  paste0(working_directory, "plots/", "phylo_mean_pairwise_distance.png")
)
```

## phylo_mrca_changes

```{r}
ggplot(
    summary_data,
    aes(
      x=env_chg_rate_label,
      y=phylo_mrca_changes,
      fill=env_condition
    )
  ) +
  geom_flat_violin(
    position = position_nudge(x = .2, y = 0),
    alpha = .8,
    adjust=1.5
  ) +
  geom_point(
    mapping=aes(color=env_condition),
    position = position_jitter(width = .15),
    size = .5,
    alpha = 0.8
  ) +
  geom_boxplot(
    width = .1,
    outlier.shape = NA,
    alpha = 0.5
  ) +
  scale_fill_brewer(
    palette=cb_palette
  ) +
  scale_color_brewer(
    palette=cb_palette
  ) +
  scale_y_continuous(
    trans=log10_trans()
  ) +
  facet_grid(
    COPY_MUT_PROB~env_type_label,
    scales="free"
  ) +
  theme(
    legend.position="none",
    axis.text=element_text(size=14),
    panel.border = element_rect(color = "grey", fill=NA, size=1.5)
  )
ggsave(
  paste0(working_directory, "plots/", "phylo_mrca_changes.png")
)
```

```{r}
ggplot(
    time_series_data,
    aes(
      x=update,
      y=phylo_mrca_changes,
      fill=env_condition,
      color=env_condition
    )
  ) +
  stat_summary(geom="line", fun=mean) +
  stat_summary(
    geom="ribbon",
    fun.min=min,
    fun.max=max,
    alpha=0.2,
    linetype=0
  ) +
  # stat_summary(
  #   geom="ribbon",
  #   fun.data="mean_cl_boot",
  #   fun.args=list(conf.int=0.95),
  #   alpha=0.2,
  #   linetype=0
  # ) +
  scale_fill_brewer(
    palette=cb_palette
  ) +
  scale_color_brewer(
    palette=cb_palette
  ) +
  scale_y_continuous(
    trans=log10_trans()
  ) +
  facet_grid(
    COPY_MUT_PROB~env_type_label
  ) +
  theme(
    legend.position="bottom"
  )

ggsave(
  paste0(working_directory, "plots/", "phylo_mrca_changes_ot.pdf"),
  width=18,
  height=10
)
ggsave(
  paste0(working_directory, "plots/", "phylo_mrca_changes_ot.png"),
  width=18,
  height=10
)
```

## phylo_mrca_depth

```{r}
ggplot(
    summary_data,
    aes(
      x=env_chg_rate_label,
      y=phylo_mrca_depth,
      fill=env_condition
    )
  ) +
  geom_flat_violin(
    position = position_nudge(x = .2, y = 0),
    alpha = .8,
    adjust=1.5
  ) +
  geom_point(
    mapping=aes(color=env_condition),
    position = position_jitter(width = .15),
    size = .5,
    alpha = 0.8
  ) +
  geom_boxplot(
    width = .1,
    outlier.shape = NA,
    alpha = 0.5
  ) +
  scale_fill_brewer(
    palette=cb_palette
  ) +
  scale_color_brewer(
    palette=cb_palette
  ) +
  scale_y_continuous(
    trans=log10_trans()
  ) +
  facet_grid(
    COPY_MUT_PROB~env_type_label,
    scales="free"
  ) +
  theme(
    legend.position="none",
    axis.text=element_text(size=14),
    panel.border = element_rect(color = "grey", fill=NA, size=1.5)
  )
ggsave(
  paste0(working_directory, "plots/", "phylo_mrca_depth.png")
)
```

```{r}
ggplot(
    filter(time_series_data, (update%%1000)==0),
    aes(
      x=update,
      y=phylo_mrca_depth,
      fill=env_condition,
      color=env_condition
    )
  ) +
  stat_summary(geom="line", fun=mean) +
  stat_summary(
    geom="ribbon",
    fun.min=min,
    fun.max=max,
    alpha=0.2,
    linetype=0
  ) +
  # stat_summary(
  #   geom="ribbon",
  #   fun.data="mean_cl_boot",
  #   fun.args=list(conf.int=0.95),
  #   alpha=0.2,
  #   linetype=0
  # ) +
  scale_fill_brewer(
    palette=cb_palette
  ) +
  scale_color_brewer(
    palette=cb_palette
  ) +
  # scale_y_continuous(
  #   # trans=log10_trans()
  #   trans=pseudo_log_trans(sigma=1,base=10),
  #   breaks=c(0, 10, 100, 1000, 10000)
  # ) +
  facet_grid(
    COPY_MUT_PROB~env_type_label
  ) +
  theme(
    legend.position="bottom"
  )

ggsave(
  paste0(working_directory, "plots/", "phylo_mrca_depth_ot.pdf"),
  width=18,
  height=10
)
ggsave(
  paste0(working_directory, "plots/", "phylo_mrca_depth_ot.png"),
  width=18,
  height=10
)
```

## phylo_num_taxa_extant

```{r}
ggplot(
    summary_data,
    aes(
      x=env_condition,
      y=phylo_num_taxa_extant,
      fill=env_condition
    )
  ) +
  geom_flat_violin(
    position = position_nudge(x = .2, y = 0),
    alpha = .8,
    adjust=1.5
  ) +
  geom_point(
    mapping=aes(color=env_condition),
    position = position_jitter(width = .15),
    size = .5,
    alpha = 0.8
  ) +
  geom_boxplot(
    width = .1,
    outlier.shape = NA,
    alpha = 0.5
  ) +
  facet_grid(
    ~COPY_MUT_PROB
  ) +
  scale_color_brewer(
    palette = cb_palette
  ) +
  scale_fill_brewer(
    palette = cb_palette
  ) +
  theme(
    legend.position="none",
    axis.text.x = element_text(angle = 90)
  )

ggsave(
  paste0(working_directory, "plots/", "phylo_num_taxa_extant.pdf")
)
```

## phylo_num_taxa_tree

```{r}
ggplot(
    summary_data,
    aes(
      x=env_chg_rate_label,
      y=phylo_num_taxa_tree,
      fill=env_condition
    )
  ) +
  geom_flat_violin(
    position = position_nudge(x = .2, y = 0),
    alpha = .8,
    adjust=1.5
  ) +
  geom_point(
    mapping=aes(color=env_condition),
    position = position_jitter(width = .15),
    size = .5,
    alpha = 0.8
  ) +
  geom_boxplot(
    width = .1,
    outlier.shape = NA,
    alpha = 0.5
  ) +
  scale_fill_brewer(
    palette=cb_palette
  ) +
  scale_color_brewer(
    palette=cb_palette
  ) +
  # scale_y_continuous(
  #   trans=log10_trans()
  # ) +
  facet_grid(
    COPY_MUT_PROB~env_type_label,
    scales="free"
  ) +
  theme(
    legend.position="none",
    axis.text=element_text(size=14),
    panel.border = element_rect(color = "grey", fill=NA, size=1.5)
  )
ggsave(
  paste0(working_directory, "plots/", "phylo_num_taxa_tree.png")
)
```

## phylo_sum_pairwise_distance

```{r}
ggplot(
    summary_data,
    aes(
      x=env_chg_rate_label,
      y=phylo_sum_pairwise_distance,
      fill=env_condition
    )
  ) +
  geom_flat_violin(
    position = position_nudge(x = .2, y = 0),
    alpha = .8,
    adjust=1.5
  ) +
  geom_point(
    mapping=aes(color=env_condition),
    position = position_jitter(width = .15),
    size = .5,
    alpha = 0.8
  ) +
  geom_boxplot(
    width = .1,
    outlier.shape = NA,
    alpha = 0.5
  ) +
  scale_fill_brewer(
    palette=cb_palette
  ) +
  scale_color_brewer(
    palette=cb_palette
  ) +
  scale_y_continuous(
    trans=log10_trans()
  ) +
  facet_grid(
    COPY_MUT_PROB~env_type_label,
    scales="free"
  ) +
  theme(
    legend.position="none",
    axis.text=element_text(size=14),
    panel.border = element_rect(color = "grey", fill=NA, size=1.5)
  )
ggsave(
  paste0(working_directory, "plots/", "phylo_sum_pairwise_distance.png")
)
```

## Knockout analyses

```{r}
ko_data_loc <- paste0(working_directory, "data/knockouts_run_summary_extant-only.csv")
ko_data <- read.csv(ko_data_loc, na.strings="NONE")

ko_data$COPY_MUT_PROB <- as.factor(
  ko_data$COPY_MUT_PROB
)
ko_data$env_chg_rate <- as.factor(
  ko_data$env_chg_rate
)
ko_data$env_condition <- as.factor(
  ko_data$env_condition
)
ko_data$env_type <- as.factor(
  ko_data$env_type
)

ko_data$env_chg_rate_label <- mapply(
  get_env_chg_rate_label,
  ko_data$env_chg_rate,
  ko_data$env_type
)
ko_data$env_chg_rate_label <- factor(
  ko_data$env_chg_rate_label,
  levels=c(
    "none-a",
    "none-b",
    "30",
    "300",
    "3000"
  )
)
ko_data$env_type_label <- mapply(
  get_env_type_label,
  ko_data$env_type
)
ko_data$combined_env_type_label <- mapply(
  get_combined_env_type_label,
  ko_data$env_type
)

# Sites per task
ko_data$extant_sites_per_task <- ko_data$extant_num_task_sites / ko_data$extant_num_tasks_performed
ko_data$extant_prop_multi_task_sites <- ko_data$extant_num_multi_task_sites / ko_data$extant_num_task_sites
```

### extant_num_tasks_performed

```{r}
ggplot(
    ko_data,
    aes(
      x=env_chg_rate_label,
      y=extant_num_tasks_performed,
      fill=env_condition
    )
  ) +
  geom_flat_violin(
    position = position_nudge(x = .2, y = 0),
    alpha = .8,
    adjust=1.5
  ) +
  geom_point(
    mapping=aes(color=env_condition),
    position = position_jitter(width = .15),
    size = .5,
    alpha = 0.8
  ) +
  geom_boxplot(
    width = .1,
    outlier.shape = NA,
    alpha = 0.5
  ) +
  scale_fill_brewer(
    palette=cb_palette
  ) +
  scale_color_brewer(
    palette=cb_palette
  ) +
  # scale_y_continuous(
  #   trans=log10_trans()
  # ) +
  facet_grid(
    COPY_MUT_PROB~env_type_label,
    scales="free"
  ) +
  theme(
    legend.position="none",
    axis.text=element_text(size=14),
    panel.border = element_rect(color = "grey", fill=NA, size=1.5)
  )
ggsave(
  paste0(working_directory, "plots/", "extant_num_tasks_performed.pdf")
)
```

### extant_num_task_sites

```{r}
ggplot(
    filter(ko_data, extant_num_tasks_performed==3),
    aes(
      x=env_chg_rate_label,
      y=extant_num_task_sites,
      fill=env_condition
    )
  ) +
  geom_flat_violin(
    position = position_nudge(x = .2, y = 0),
    alpha = .8,
    adjust=1.5
  ) +
  geom_point(
    mapping=aes(color=env_condition),
    position = position_jitter(width = .15),
    size = .5,
    alpha = 0.8
  ) +
  geom_boxplot(
    width = .1,
    outlier.shape = NA,
    alpha = 0.5
  ) +
  scale_fill_brewer(
    palette=cb_palette
  ) +
  scale_color_brewer(
    palette=cb_palette
  ) +
  # scale_y_continuous(
  #   trans=log10_trans()
  # ) +
  facet_grid(
    combined_env_type_label~COPY_MUT_PROB,
    scales="free_x"
  ) +
  theme(
    legend.position="none",
    axis.text=element_text(size=14),
    axis.text.x=element_text(angle=45,hjust=1),
    panel.border = element_rect(color = "grey", fill=NA, size=1.5)
  )
ggsave(
  paste0(working_directory, "plots/", "extant_num_task_sites.pdf")
)
```

### extant_sites_per_task

```{r}
ggplot(
    filter(ko_data,extant_tasks_performed=="and;not;or"),
    aes(
      x=env_chg_rate_label,
      y=extant_sites_per_task,
      fill=env_condition
    )
  ) +
  geom_flat_violin(
    position = position_nudge(x = .2, y = 0),
    alpha = .8,
    adjust=1.5
  ) +
  geom_point(
    mapping=aes(color=env_condition),
    position = position_jitter(width = .15),
    size = .5,
    alpha = 0.8
  ) +
  geom_boxplot(
    width = .1,
    outlier.shape = NA,
    alpha = 0.5
  ) +
  # scale_fill_brewer(
  #   palette=cb_palette
  # ) +
  # scale_color_brewer(
  #   palette=cb_palette
  # ) +
  # scale_y_continuous(

  # ) +
  facet_grid(
    combined_env_type_label~COPY_MUT_PROB,
    scales="free_x"
  ) +
  theme(
    legend.position="none",
    axis.text=element_text(size=14),
    axis.text.x=element_text(angle=45,hjust=1),
    panel.border = element_rect(color = "grey", fill=NA, size=1.5)
  )
ggsave(
  paste0(working_directory, "plots/", "extant_sites_per_task.pdf")
)
```

### Num sites for each task

```{r}
ko_longer <- pivot_longer(
  ko_data,
  cols=c(
    "extant_num_and_sites",
    "extant_num_andnot_sites",
    "extant_num_nand_sites",
    "extant_num_not_sites",
    "extant_num_or_sites",
    "extant_num_ornot_sites"
  ),
  names_to="task_name",
  values_to="num_sites"
)
```

```{r}
ggplot(
    filter(ko_longer, num_sites>0),
    aes(
      x=COPY_MUT_PROB,
      y=num_sites,
      fill=env_condition
    )
  ) +
  geom_flat_violin(
    position = position_nudge(x = .2, y = 0),
    alpha = .8,
    adjust=1.5
  ) +
  geom_point(
    mapping=aes(color=env_condition),
    position = position_jitter(width = .15),
    size = .5,
    alpha = 0.8
  ) +
  geom_boxplot(
    width = .1,
    outlier.shape = NA,
    alpha = 0.5
  ) +
  scale_fill_brewer(
    palette=cb_palette
  ) +
  scale_color_brewer(
    palette=cb_palette
  ) +
  # scale_y_continuous(
  #   trans=log10_trans()
  # ) +
  facet_grid(
    task_name~env_condition,
    scales="free_x"
  ) +
  theme(
    legend.position="none",
    axis.text=element_text(size=14),
    axis.text.x=element_text(angle=45,hjust=1),
    panel.border = element_rect(color = "grey", fill=NA, size=1.5)
  )
ggsave(
  paste0(working_directory, "plots/", "extant_num_task_sites_by_task.pdf"),
  height=20,
  width=18
)
```

### extant_num_multi_task_sites

```{r}
ggplot(
    ko_data,
    aes(
      x=env_chg_rate_label,
      y=extant_num_multi_task_sites,
      fill=env_condition
    )
  ) +
  geom_flat_violin(
    position = position_nudge(x = .2, y = 0),
    alpha = .8,
    adjust=1.5
  ) +
  geom_point(
    mapping=aes(color=env_condition),
    position = position_jitter(width = .15),
    size = .5,
    alpha = 0.8
  ) +
  geom_boxplot(
    width = .1,
    outlier.shape = NA,
    alpha = 0.5
  ) +
  scale_fill_brewer(
    palette=cb_palette
  ) +
  scale_color_brewer(
    palette=cb_palette
  ) +
  # scale_y_continuous(
  #   trans=log10_trans()
  # ) +
  facet_grid(
    combined_env_type_label~COPY_MUT_PROB,
    scales="free_x"
  ) +
  theme(
    legend.position="none",
    axis.text=element_text(size=14),
    axis.text.x=element_text(angle=45,hjust=1),
    panel.border = element_rect(color = "grey", fill=NA, size=1.5)
  )
ggsave(
  paste0(working_directory, "plots/", "extant_num_multi_task_sites.pdf")
)
```

### extant_prop_multi_task_sites

```{r}
ggplot(
    ko_data,
    aes(
      x=env_chg_rate_label,
      y=extant_prop_multi_task_sites,
      fill=env_condition
    )
  ) +
  geom_flat_violin(
    position = position_nudge(x = .2, y = 0),
    alpha = .8,
    adjust=1.5
  ) +
  geom_point(
    mapping=aes(color=env_condition),
    position = position_jitter(width = .15),
    size = .5,
    alpha = 0.8
  ) +
  geom_boxplot(
    width = .1,
    outlier.shape = NA,
    alpha = 0.5
  ) +
  scale_fill_brewer(
    palette=cb_palette
  ) +
  scale_color_brewer(
    palette=cb_palette
  ) +
  # scale_y_continuous(
  #   trans=log10_trans()
  # ) +
  facet_grid(
    combined_env_type_label~COPY_MUT_PROB,
    scales="free_x"
  ) +
  theme(
    legend.position="none",
    axis.text=element_text(size=14),
    axis.text.x=element_text(angle=45,hjust=1),
    panel.border = element_rect(color = "grey", fill=NA, size=1.5)
  )
ggsave(
  paste0(working_directory, "plots/", "extant_prop_multi_task_sites.pdf")
)
```

### extant_num_task_env_a_sites


### extant_num_task_env_b_sites


### extant_num_viability_sites

```{r}
ggplot(
    ko_data,
    aes(
      x=env_chg_rate_label,
      y=extant_num_viability_sites,
      fill=env_condition
    )
  ) +
  geom_flat_violin(
    position = position_nudge(x = .2, y = 0),
    alpha = .8,
    adjust=1.5
  ) +
  geom_point(
    mapping=aes(color=env_condition),
    position = position_jitter(width = .15),
    size = .5,
    alpha = 0.8
  ) +
  geom_boxplot(
    width = .1,
    outlier.shape = NA,
    alpha = 0.5
  ) +
  scale_fill_brewer(
    palette=cb_palette
  ) +
  scale_color_brewer(
    palette=cb_palette
  ) +
  # scale_y_continuous(
  #   trans=log10_trans()
  # ) +
  facet_grid(
    combined_env_type_label~COPY_MUT_PROB,
    scales="free_x"
  ) +
  theme(
    legend.position="none",
    axis.text=element_text(size=14),
    axis.text.x=element_text(angle=45,hjust=1),
    panel.border = element_rect(color = "grey", fill=NA, size=1.5)
  )
ggsave(
  paste0(working_directory, "plots/", "extant_num_viability_sites.pdf")
)
```

## Pairwise knockout data

```{r}
pw_ko_data_loc <- paste0(working_directory, "data/pairwise_knockouts_run_summary.csv")
pw_ko_data <- read.csv(pw_ko_data_loc, na.strings="NONE")

pw_ko_data$COPY_MUT_PROB <- as.factor(
  pw_ko_data$COPY_MUT_PROB
)
pw_ko_data$env_chg_rate <- as.factor(
  pw_ko_data$env_chg_rate
)
pw_ko_data$env_condition <- as.factor(
  pw_ko_data$env_condition
)
pw_ko_data$env_type <- as.factor(
  pw_ko_data$env_type
)

pw_ko_data$env_chg_rate_label <- mapply(
  get_env_chg_rate_label,
  pw_ko_data$env_chg_rate,
  pw_ko_data$env_type
)
pw_ko_data$env_chg_rate_label <- factor(
  pw_ko_data$env_chg_rate_label,
  levels=c(
    "none-a",
    "none-b",
    "30",
    "300",
    "3000"
  )
)
pw_ko_data$env_type_label <- mapply(
  get_env_type_label,
  pw_ko_data$env_type
)
pw_ko_data$combined_env_type_label <- mapply(
  get_combined_env_type_label,
  pw_ko_data$env_type
)

pw_ko_data$redundant_sites_per_task <- pw_ko_data$num_redundant_task_sites / pw_ko_data$num_tasks_performed
pw_ko_data$sites_per_task <- pw_ko_data$num_task_coding_sites / pw_ko_data$num_tasks_performed
pw_ko_data$prop_multi_task_sites <- pw_ko_data$num_multi_task_sites / pw_ko_data$num_task_coding_sites

pw_ko_longer <- pivot_longer(
  pw_ko_data,
  cols=c(
    "num_and_task_coding_sites",
    "num_andnot_task_coding_sites",
    "num_nand_task_coding_sites",
    "num_not_task_coding_sites",
    "num_or_task_coding_sites",
    "num_ornot_task_coding_sites"
  ),
  names_to="task_name",
  values_to="num_sites"
)
```

### num_redundant_viability_sites

```{r}
ggplot(
    pw_ko_data,
    aes(
      x=env_chg_rate_label,
      y=num_redundant_viability_sites,
      fill=env_condition
    )
  ) +
  geom_flat_violin(
    position = position_nudge(x = .2, y = 0),
    alpha = .8,
    adjust=1.5
  ) +
  geom_point(
    mapping=aes(color=env_condition),
    position = position_jitter(width = .15),
    size = .5,
    alpha = 0.8
  ) +
  geom_boxplot(
    width = .1,
    outlier.shape = NA,
    alpha = 0.5
  ) +
  scale_fill_brewer(
    palette=cb_palette
  ) +
  scale_color_brewer(
    palette=cb_palette
  ) +
  # scale_y_continuous(
  #   trans=log10_trans()
  # ) +
  facet_grid(
    combined_env_type_label~COPY_MUT_PROB,
    scales="free_x"
  ) +
  theme(
    legend.position="none",
    axis.text=element_text(size=14),
    axis.text.x=element_text(angle=45,hjust=1),
    panel.border = element_rect(color = "grey", fill=NA, size=1.5)
  )
ggsave(
  paste0(working_directory, "plots/", "num_redundant_viability_sites.pdf")
)
```

### num_viability_sites

```{r}
ggplot(
    pw_ko_data,
    aes(
      x=env_chg_rate_label,
      y=num_viability_sites,
      fill=env_condition
    )
  ) +
  geom_flat_violin(
    position = position_nudge(x = .2, y = 0),
    alpha = .8,
    adjust=1.5
  ) +
  geom_point(
    mapping=aes(color=env_condition),
    position = position_jitter(width = .15),
    size = .5,
    alpha = 0.8
  ) +
  geom_boxplot(
    width = .1,
    outlier.shape = NA,
    alpha = 0.5
  ) +
  scale_fill_brewer(
    palette=cb_palette
  ) +
  scale_color_brewer(
    palette=cb_palette
  ) +
  # scale_y_continuous(
  #   trans=log10_trans()
  # ) +
  facet_grid(
    combined_env_type_label~COPY_MUT_PROB,
    scales="free_x"
  ) +
  theme(
    legend.position="none",
    axis.text=element_text(size=14),
    axis.text.x=element_text(angle=45,hjust=1),
    panel.border = element_rect(color = "grey", fill=NA, size=1.5)
  )
ggsave(
  paste0(working_directory, "plots/", "num_viability_sites.pdf")
)
```

### num_task_recovery_sites

```{r}
ggplot(
    pw_ko_data,
    aes(
      x=env_chg_rate_label,
      y=num_task_recovery_sites,
      fill=env_condition
    )
  ) +
  geom_flat_violin(
    position = position_nudge(x = .2, y = 0),
    alpha = .8,
    adjust=1.5
  ) +
  geom_point(
    mapping=aes(color=env_condition),
    position = position_jitter(width = .15),
    size = .5,
    alpha = 0.8
  ) +
  geom_boxplot(
    width = .1,
    outlier.shape = NA,
    alpha = 0.5
  ) +
  scale_fill_brewer(
    palette=cb_palette
  ) +
  scale_color_brewer(
    palette=cb_palette
  ) +
  # scale_y_continuous(
  #   trans=log10_trans()
  # ) +
  facet_grid(
    combined_env_type_label~COPY_MUT_PROB,
    scales="free_x"
  ) +
  theme(
    legend.position="none",
    axis.text=element_text(size=14),
    axis.text.x=element_text(angle=45,hjust=1),
    panel.border = element_rect(color = "grey", fill=NA, size=1.5)
  )
ggsave(
  paste0(working_directory, "plots/", "num_task_recovery_sites.pdf")
)
```

### num_redundant_task_sites

```{r}
ggplot(
    pw_ko_data,
    aes(
      x=env_chg_rate_label,
      y=num_redundant_task_sites,
      fill=env_condition
    )
  ) +
  geom_flat_violin(
    position = position_nudge(x = .2, y = 0),
    alpha = .8,
    adjust=1.5
  ) +
  geom_point(
    mapping=aes(color=env_condition),
    position = position_jitter(width = .15),
    size = .5,
    alpha = 0.8
  ) +
  geom_boxplot(
    width = .1,
    outlier.shape = NA,
    alpha = 0.5
  ) +
  scale_fill_brewer(
    palette=cb_palette
  ) +
  scale_color_brewer(
    palette=cb_palette
  ) +
  # scale_y_continuous(
  #   trans=log10_trans()
  # ) +
  facet_grid(
    combined_env_type_label~COPY_MUT_PROB,
    scales="free_x"
  ) +
  theme(
    legend.position="none",
    axis.text=element_text(size=14),
    axis.text.x=element_text(angle=45,hjust=1),
    panel.border = element_rect(color = "grey", fill=NA, size=1.5)
  )
ggsave(
  paste0(working_directory, "plots/", "num_redundant_task_sites.pdf")
)
```


### num_nonredundant_task_sites

```{r}
ggplot(
    pw_ko_data,
    aes(
      x=env_chg_rate_label,
      y=num_nonredundant_task_sites,
      fill=env_condition
    )
  ) +
  geom_flat_violin(
    position = position_nudge(x = .2, y = 0),
    alpha = .8,
    adjust=1.5
  ) +
  geom_point(
    mapping=aes(color=env_condition),
    position = position_jitter(width = .15),
    size = .5,
    alpha = 0.8
  ) +
  geom_boxplot(
    width = .1,
    outlier.shape = NA,
    alpha = 0.5
  ) +
  scale_fill_brewer(
    palette=cb_palette
  ) +
  scale_color_brewer(
    palette=cb_palette
  ) +
  # scale_y_continuous(
  #   trans=log10_trans()
  # ) +
  facet_grid(
    combined_env_type_label~COPY_MUT_PROB,
    scales="free_x"
  ) +
  theme(
    legend.position="none",
    axis.text=element_text(size=14),
    axis.text.x=element_text(angle=45,hjust=1),
    panel.border = element_rect(color = "grey", fill=NA, size=1.5)
  )
ggsave(
  paste0(working_directory, "plots/", "num_nonredundant_task_sites.pdf")
)
```

### num_task_coding_sites

```{r}
ggplot(
    # filter(pw_ko_data,tasks_performed=="and;not;or"),
    pw_ko_data,
    aes(
      x=env_chg_rate_label,
      y=num_task_coding_sites,
      fill=env_condition
    )
  ) +
  geom_flat_violin(
    position = position_nudge(x = .2, y = 0),
    alpha = .8,
    adjust=1.5
  ) +
  geom_point(
    mapping=aes(color=env_condition),
    position = position_jitter(width = .15),
    size = .5,
    alpha = 0.8
  ) +
  geom_boxplot(
    width = .1,
    outlier.shape = NA,
    alpha = 0.5
  ) +
  scale_fill_brewer(
    palette=cb_palette
  ) +
  scale_color_brewer(
    palette=cb_palette
  ) +
  # scale_y_continuous(
  #   trans=log10_trans()
  # ) +
  facet_grid(
    combined_env_type_label~COPY_MUT_PROB,
    scales="free_x"
  ) +
  theme(
    legend.position="none",
    axis.text=element_text(size=14),
    axis.text.x=element_text(angle=45,hjust=1),
    panel.border = element_rect(color = "grey", fill=NA, size=1.5)
  )
ggsave(
  paste0(working_directory, "plots/", "num_task_coding_sites.pdf")
)
```

### sites_per_task

```{r}
ggplot(
    # filter(pw_ko_data,tasks_performed=="and;not;or"),
    pw_ko_data,
    aes(
      x=env_chg_rate_label,
      y=sites_per_task,
      fill=env_condition
    )
  ) +
  geom_flat_violin(
    position = position_nudge(x = .2, y = 0),
    alpha = .8,
    adjust=1.5
  ) +
  geom_point(
    mapping=aes(color=env_condition),
    position = position_jitter(width = .15),
    size = .5,
    alpha = 0.8
  ) +
  geom_boxplot(
    width = .1,
    outlier.shape = NA,
    alpha = 0.5
  ) +
  scale_fill_brewer(
    palette=cb_palette
  ) +
  scale_color_brewer(
    palette=cb_palette
  ) +
  # scale_y_continuous(
  #   trans=log10_trans()
  # ) +
  facet_grid(
    combined_env_type_label~COPY_MUT_PROB,
    scales="free_x"
  ) +
  theme(
    legend.position="none",
    axis.text=element_text(size=14),
    axis.text.x=element_text(angle=45,hjust=1),
    panel.border = element_rect(color = "grey", fill=NA, size=1.5)
  )
ggsave(
  paste0(working_directory, "plots/", "sites_per_task.pdf")
)
```

### prop_multi_task_sites

```{r}
ggplot(
    # filter(pw_ko_data,tasks_performed=="and;not;or"),
    pw_ko_data,
    aes(
      x=env_chg_rate_label,
      y=prop_multi_task_sites,
      fill=env_condition
    )
  ) +
  geom_flat_violin(
    position = position_nudge(x = .2, y = 0),
    alpha = .8,
    adjust=1.5
  ) +
  geom_point(
    mapping=aes(color=env_condition),
    position = position_jitter(width = .15),
    size = .5,
    alpha = 0.8
  ) +
  geom_boxplot(
    width = .1,
    outlier.shape = NA,
    alpha = 0.5
  ) +
  scale_fill_brewer(
    palette=cb_palette
  ) +
  scale_color_brewer(
    palette=cb_palette
  ) +
  # scale_y_continuous(
  #   trans=log10_trans()
  # ) +
  facet_grid(
    combined_env_type_label~COPY_MUT_PROB,
    scales="free_x"
  ) +
  theme(
    legend.position="none",
    axis.text=element_text(size=14),
    axis.text.x=element_text(angle=45,hjust=1),
    panel.border = element_rect(color = "grey", fill=NA, size=1.5)
  )
ggsave(
  paste0(working_directory, "plots/", "prop_multi_task_sites.pdf")
)
```

### Number of sites for each task

```{r}
ggplot(
    filter(
      pw_ko_longer,
      num_sites>0 &
      COPY_MUT_PROB%in%focal_mut_rates & env_condition%in%focal_envs
    ),
    aes(
      x=COPY_MUT_PROB,
      y=num_sites,
      fill=env_condition
    )
  ) +
  geom_flat_violin(
    position = position_nudge(x = .2, y = 0),
    alpha = .8,
    adjust=1.5
  ) +
  geom_point(
    mapping=aes(color=env_condition),
    position = position_jitter(width = .15),
    size = .5,
    alpha = 0.8
  ) +
  geom_boxplot(
    width = .1,
    outlier.shape = NA,
    alpha = 0.5
  ) +
  scale_fill_brewer(
    palette=cb_palette
  ) +
  scale_color_brewer(
    palette=cb_palette
  ) +
  # scale_y_continuous(
  #   trans=log10_trans()
  # ) +
  facet_grid(
    task_name~env_condition,
    scales="free_x"
  ) +
  theme(
    legend.position="none",
    axis.text=element_text(size=14),
    axis.text.x=element_text(angle=45,hjust=1),
    panel.border = element_rect(color = "grey", fill=NA, size=1.5)
  )
ggsave(
  paste0(working_directory, "plots/", "pw_num_task_sites_by_task.pdf"),
  height=20,
  width=18
)
```

## Manuscript figures

```{r}
focal_mut_rate <- 0.001
focal_mut_rates <- c(0.0001, 0.001, 0.0316)
focal_envs <- c(
  "env-consta",
  "env-constb",
  "env-cycling_rate-300",
  "env-random_rate-300"
)
env_breaks<-c("consta", "constb", "cycling", "random")
env_labels<-c("Const-A", "Const-B", "Cyclic", "Random")

env_facets <- c(
  "env-consta"="Const-A",
  "env-constb"="Const-B",
  "env-cycling_rate-300"="Cyclic",
  "env-random_rate-300"="Random"
)
env_facet_labeller <- function(variable, value) {
  return(env_facets[value])
}
```

### True replication rate

```{r}
# focal_mut_rates <- c(0.0001, 0.001, 0.0316)
fig_replication_rate_ot <-
  ggplot(
    filter(
      time_series_data,
      # (update%%10000)==0&
      COPY_MUT_PROB%in%focal_mut_rates & env_condition%in%focal_envs
    ),
    aes(
      x=update,
      y=avg_true_replication_rate,
      fill=env_condition,
      color=env_condition
    )
  ) +
  stat_summary(geom="line", fun=mean) +
  stat_summary(
    geom="ribbon",
    fun.data="mean_cl_boot",
    fun.args=list(conf.int=0.95),
    alpha=0.2,
    linetype=0
  ) +
  scale_fill_brewer(
    palette=cb_palette,
    name="Env:",
    # breaks=env_breaks
    # limits=env_breaks,
    labels=env_labels
  ) +
  scale_color_brewer(
    palette=cb_palette,
    name="Env:",
    # breaks=env_breaks,
    # limits=env_breaks,
    labels=env_labels
  ) +
  scale_y_continuous(
    name="Reproduction rate"
  ) +
  scale_x_continuous(
    name="Update",
    breaks=c(0, 100000, 200000, 300000)
  ) +
  facet_grid(
    ~COPY_MUT_PROB
  ) +
  theme(
    legend.position="bottom",
    axis.text.x=element_text(angle=45,hjust=1)
  )
# fig_replication_rate_ot
ggsave(
  filename=paste0(plot_directory, "2022-03-14-replication-rate-figure.pdf"),
  plot=fig_replication_rate_ot,
  width=12,
  height=4
)
```

### Robustness

#### Number of redundant task sites

```{r}
fig_num_redundant_task_sites <-
  ggplot(
    filter(
      pw_ko_data,
      COPY_MUT_PROB%in%focal_mut_rates & env_condition%in%focal_envs
    ),
    aes(
      x=COPY_MUT_PROB,
      # y=num_redundant_task_sites,
      y=redundant_sites_per_task,
      fill=env_condition
    )
  ) +
  geom_flat_violin(
    position = position_nudge(x = .2, y = 0),
    alpha = .8,
    adjust=1.5
  ) +
  geom_point(
    mapping=aes(color=env_condition),
    position = position_jitter(width = .15),
    size = 1,
    alpha = 0.8
  ) +
  geom_boxplot(
    width = .1,
    outlier.shape = NA,
    alpha = 0.5
  ) +
  scale_fill_brewer(
    palette=cb_palette
  ) +
  scale_color_brewer(
    palette=cb_palette
  ) +
  scale_y_continuous(
    name="Redundant sites per task"
  ) +
  scale_x_discrete(
    name="Mutation rate"
  ) +
  facet_wrap(
    ~env_condition,
    nrow=1,
    labeller=as_labeller(env_facets)
  ) +
  theme(
    legend.position="none",
    axis.text=element_text(size=14)
  )
fig_num_redundant_task_sites
```

#### Number of overlapping task sites

```{r}
fig_prop_multi_task_sites <-
  ggplot(
    filter(
      pw_ko_data,
      COPY_MUT_PROB%in%focal_mut_rates & env_condition%in%focal_envs
    ),
    aes(
      x=COPY_MUT_PROB,
      y=prop_multi_task_sites,
      fill=env_condition
    )
  ) +
  geom_flat_violin(
    position = position_nudge(x = .2, y = 0),
    alpha = .8,
    adjust=1.5
  ) +
  geom_point(
    mapping=aes(color=env_condition),
    position = position_jitter(width = .15),
    size = 1,
    alpha = 0.8
  ) +
  geom_boxplot(
    width = .1,
    outlier.shape = NA,
    alpha = 0.5
  ) +
  scale_fill_brewer(
    palette=cb_palette
  ) +
  scale_color_brewer(
    palette=cb_palette
  ) +
  scale_y_continuous(
    name="Proportion shared task sites"
  ) +
  scale_x_discrete(
    name="Mutation rate"
  ) +
  facet_wrap(
    ~env_condition,
    nrow=1,
    labeller=as_labeller(env_facets)
  ) +
  theme(
    legend.position="none",
    axis.text=element_text(size=14)
  )
fig_prop_multi_task_sites
```

#### Number of task coding sites

```{r}
fig_num_task_coding_sites <-
  ggplot(
    filter(
      pw_ko_data,
      COPY_MUT_PROB%in%focal_mut_rates & env_condition%in%focal_envs
    ),
    aes(
      x=COPY_MUT_PROB,
      y=sites_per_task,
      # y=num_task_coding_sites,
      fill=env_condition
    )
  ) +
  geom_flat_violin(
    position = position_nudge(x = .2, y = 0),
    alpha = .8,
    adjust=1.5
  ) +
  geom_point(
    mapping=aes(color=env_condition),
    position = position_jitter(width = .15),
    size = 1,
    alpha = 0.8
  ) +
  geom_boxplot(
    width = .1,
    outlier.shape = NA,
    alpha = 0.5
  ) +
  scale_fill_brewer(
    palette=cb_palette
  ) +
  scale_color_brewer(
    palette=cb_palette
  ) +
  scale_y_continuous(
    name="Avg. sites per task"
  ) +
  scale_x_discrete(
    name="Mutation rate"
  ) +
  facet_wrap(
    ~env_condition,
    nrow=1,
    labeller=as_labeller(env_facets)
  ) +
  theme(
    legend.position="none",
    axis.text=element_text(size=14)
  )
fig_num_task_coding_sites
```

#### Combined

```{r}

ggsave(
  filename=paste0(plot_directory, "2022-03-14-num-redundant-sites.pdf"),
  plot=fig_num_redundant_task_sites,
  width=12,
  height=4
)
ggsave(
  filename=paste0(plot_directory, "2022-03-14-prop-multi-task-sites.pdf"),
  plot=fig_prop_multi_task_sites,
  width=12,
  height=4
)
ggsave(
  filename=paste0(plot_directory, "2022-03-14-sites-per-task.pdf"),
  plot=fig_num_task_coding_sites,
  width=12,
  height=4
)


```


