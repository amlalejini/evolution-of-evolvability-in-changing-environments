# 2022-03-07 - Variable Mutation Rates - Landscape analyses

## Setup

```{r}
experiment_slug <- "2022-03-07-variable-mut"
working_directory <- paste0("experiments/",experiment_slug,"/analysis/")
```

### Analysis dependencies

Load all required R libraries

```{r}
library(tidyverse)
library(ggplot2)
library(scales)
library(cowplot)
library(RColorBrewer)
source("https://gist.githubusercontent.com/benmarwick/2a1bb0133ff568cbe28d/raw/fb53bd97121f7f9ce947837ef1a4c65a73bffb3f/geom_flat_violin.R")
```

These analyses were knit with the following environment:

```{r}
print(version)
```

### Load data

Load 1-step landscape data
```{r}
ls1_run_summary_data_loc <- paste0(working_directory, "data/landscape_run_summary_step-1.csv")
ls1_run_summary_data <- read.csv(ls1_run_summary_data_loc, na.strings="NONE")

ls1_run_summary_data$COPY_MUT_PROB <- as.factor(
  ls1_run_summary_data$COPY_MUT_PROB
)
ls1_run_summary_data$env_chg_rate <- as.factor(
  ls1_run_summary_data$env_chg_rate
)
ls1_run_summary_data$env_condition <- as.factor(
  ls1_run_summary_data$env_condition
)
ls1_run_summary_data$env_type <- as.factor(
  ls1_run_summary_data$env_type
)
```

Load 1-step task co-occurrence data.
```{r}
ls1_cooccur_data_loc <- paste0(working_directory, "data/landscape_task_cooccurrence_treatment_summary_step-1.csv")
ls1_cooccur_data <- read.csv(ls1_cooccur_data_loc, na.strings="NONE")

ls1_cooccur_data$COPY_MUT_PROB <- as.factor(
  ls1_cooccur_data$COPY_MUT_PROB
)
ls1_cooccur_data$env_chg_rate <- as.factor(
  ls1_cooccur_data$env_chg_rate
)
ls1_cooccur_data$env_condition <- as.factor(
  ls1_cooccur_data$env_condition
)
ls1_cooccur_data$env_type <- as.factor(
  ls1_cooccur_data$env_type
)
ls1_cooccur_data$task_1_id <- as.factor(
  ls1_cooccur_data$task_1_id
)
ls1_cooccur_data$task_2_id <- as.factor(
  ls1_cooccur_data$task_2_id
)
```

Load 2-step landscape data
```{r}
ls2_run_summary_data_loc <- paste0(working_directory, "data/landscape_run_summary_step-2.csv")
ls2_run_summary_data <- read.csv(ls2_run_summary_data_loc, na.strings="NONE")

ls2_run_summary_data$COPY_MUT_PROB <- as.factor(
  ls2_run_summary_data$COPY_MUT_PROB
)
ls2_run_summary_data$env_chg_rate <- as.factor(
  ls2_run_summary_data$env_chg_rate
)
ls2_run_summary_data$env_condition <- as.factor(
  ls2_run_summary_data$env_condition
)
ls2_run_summary_data$env_type <- as.factor(
  ls2_run_summary_data$env_type
)
```

Load 2-step task co-occurrence data.
```{r}
ls2_cooccur_data_loc <- paste0(working_directory, "data/landscape_task_cooccurrence_treatment_summary_step-2.csv")
ls2_cooccur_data <- read.csv(ls2_cooccur_data_loc, na.strings="NONE")

ls2_cooccur_data$COPY_MUT_PROB <- as.factor(
  ls2_cooccur_data$COPY_MUT_PROB
)
ls2_cooccur_data$env_chg_rate <- as.factor(
  ls2_cooccur_data$env_chg_rate
)
ls2_cooccur_data$env_condition <- as.factor(
  ls2_cooccur_data$env_condition
)
ls2_cooccur_data$env_type <- as.factor(
  ls2_cooccur_data$env_type
)
ls2_cooccur_data$task_1_id <- as.factor(
  ls2_cooccur_data$task_1_id
)
ls2_cooccur_data$task_2_id <- as.factor(
  ls2_cooccur_data$task_2_id
)
```

Miscellaneous setup.

```{r}
# Configure our default graphing theme
theme_set(theme_cowplot())
# Palette
cb_palette <- "Set2"
alpha <- 0.05
# Create a directory to store plots
plot_directory <- paste0(working_directory, "plots/")
dir.create(plot_directory, showWarnings=FALSE)
```

## Number of viable mutants

### 1-step mutants

```{r}
ggplot(
    ls1_run_summary_data,
    aes(
      x=env_condition,
      y=prop_viable,
      fill=env_condition
    )
  ) +
  geom_flat_violin(
    position = position_nudge(x = .2, y = 0),
    alpha = .8,
    adjust=1.5
  ) +
  geom_point(
    mapping=aes(color=env_condition),
    position = position_jitter(width = .15),
    size = .5,
    alpha = 0.8
  ) +
  geom_boxplot(
    width = .1,
    outlier.shape = NA,
    alpha = 0.5
  ) +
  scale_fill_brewer(
    palette=cb_palette
  ) +
  scale_color_brewer(
    palette=cb_palette
  ) +
  facet_wrap(
    ~COPY_MUT_PROB
  ) +
  theme(
    legend.position="none",
    axis.text.x = element_text(angle = 90),
    panel.border = element_rect(color = "grey", fill=NA, size=2)
  )

ggsave(
  paste0(working_directory, "plots/", "prob-viable-one-step-mutants.pdf")
)
```

### 2-step mutants

```{r}
ggplot(
    ls2_run_summary_data,
    aes(
      x=env_condition,
      y=prop_viable,
      fill=env_condition
    )
  ) +
  geom_flat_violin(
    position = position_nudge(x = .2, y = 0),
    alpha = .8,
    adjust=1.5
  ) +
  geom_point(
    mapping=aes(color=env_condition),
    position = position_jitter(width = .15),
    size = .5,
    alpha = 0.8
  ) +
  geom_boxplot(
    width = .1,
    outlier.shape = NA,
    alpha = 0.5
  ) +
  scale_fill_brewer(
    palette=cb_palette
  ) +
  scale_color_brewer(
    palette=cb_palette
  ) +
  facet_wrap(
    ~COPY_MUT_PROB
  ) +
  theme(
    legend.position="none",
    axis.text.x = element_text(angle = 90),
    panel.border = element_rect(color = "grey", fill=NA, size=2)
  )

ggsave(
  paste0(working_directory, "plots/", "prob-viable-two-step-mutants.pdf")
)
```

## Number of unique phenotypes

### 1-step mutants

```{r}
ggplot(
    ls1_run_summary_data,
    aes(
      x=env_condition,
      y=num_unique_viable_phenotypes,
      fill=env_condition
    )
  ) +
  geom_flat_violin(
    position = position_nudge(x = .2, y = 0),
    alpha = .8,
    adjust=1.5
  ) +
  geom_point(
    mapping=aes(color=env_condition),
    position = position_jitter(width = .15),
    size = .5,
    alpha = 0.8
  ) +
  geom_boxplot(
    width = .1,
    outlier.shape = NA,
    alpha = 0.5
  ) +
  scale_fill_brewer(
    palette=cb_palette
  ) +
  scale_color_brewer(
    palette=cb_palette
  ) +
  facet_wrap(
    ~COPY_MUT_PROB
  ) +
  theme(
    legend.position="none",
    axis.text.x = element_text(angle = 90),
    panel.border = element_rect(color = "grey", fill=NA, size=2)
  )

ggsave(
  paste0(working_directory, "plots/", "num-phenotypes-one-step-mutants.pdf")
)
```

### 2-step mutants

```{r}
ggplot(
    ls2_run_summary_data,
    aes(
      x=env_condition,
      y=num_unique_viable_phenotypes,
      fill=env_condition
    )
  ) +
  geom_flat_violin(
    position = position_nudge(x = .2, y = 0),
    alpha = .8,
    adjust=1.5
  ) +
  geom_point(
    mapping=aes(color=env_condition),
    position = position_jitter(width = .15),
    size = .5,
    alpha = 0.8
  ) +
  geom_boxplot(
    width = .1,
    outlier.shape = NA,
    alpha = 0.5
  ) +
  scale_fill_brewer(
    palette=cb_palette
  ) +
  scale_color_brewer(
    palette=cb_palette
  ) +
  facet_wrap(
    ~COPY_MUT_PROB
  ) +
  theme(
    legend.position="none",
    axis.text.x = element_text(angle = 90),
    panel.border = element_rect(color = "grey", fill=NA, size=2)
  )

ggsave(
  paste0(working_directory, "plots/", "num-phenotypes-two-step-mutants.pdf")
)
```

## Entropy of phenotypes

### 1-step mutants

```{r}
ggplot(
    ls1_run_summary_data,
    aes(
      x=env_condition,
      y=entropy_viable_phenotypes,
      fill=env_condition
    )
  ) +
  geom_flat_violin(
    position = position_nudge(x = .2, y = 0),
    alpha = .8,
    adjust=1.5
  ) +
  geom_point(
    mapping=aes(color=env_condition),
    position = position_jitter(width = .15),
    size = .5,
    alpha = 0.8
  ) +
  geom_boxplot(
    width = .1,
    outlier.shape = NA,
    alpha = 0.5
  ) +
  scale_fill_brewer(
    palette=cb_palette
  ) +
  scale_color_brewer(
    palette=cb_palette
  ) +
  facet_wrap(
    ~COPY_MUT_PROB
  ) +
  theme(
    legend.position="none",
    axis.text.x = element_text(angle = 90),
    panel.border = element_rect(color = "grey", fill=NA, size=2)
  )

ggsave(
  paste0(working_directory, "plots/", "entropy-phenotypes-one-step-mutants.pdf")
)
```

### 2-step mutants

```{r}
ggplot(
    ls2_run_summary_data,
    aes(
      x=env_condition,
      y=entropy_viable_phenotypes,
      fill=env_condition
    )
  ) +
  geom_flat_violin(
    position = position_nudge(x = .2, y = 0),
    alpha = .8,
    adjust=1.5
  ) +
  geom_point(
    mapping=aes(color=env_condition),
    position = position_jitter(width = .15),
    size = .5,
    alpha = 0.8
  ) +
  geom_boxplot(
    width = .1,
    outlier.shape = NA,
    alpha = 0.5
  ) +
  scale_fill_brewer(
    palette=cb_palette
  ) +
  scale_color_brewer(
    palette=cb_palette
  ) +
  facet_wrap(
    ~COPY_MUT_PROB
  ) +
  theme(
    legend.position="none",
    axis.text.x = element_text(angle = 90),
    panel.border = element_rect(color = "grey", fill=NA, size=2)
  )

ggsave(
  paste0(working_directory, "plots/", "entropy-phenotypes-two-step-mutants.pdf")
)
```

## Co-occurrence matrices

### 1-step mutants

```{r}
ggplot(
    ls1_cooccur_data,
    aes(
      x=task_1_id,
      y=task_2_id,
      fill=cooccur_expectation_avg
    )
  ) +
  geom_tile() +
  scale_fill_distiller(
    palette = "RdBu"
    # limits=c(-10, 10)
  ) +
  facet_grid(
    env_condition~COPY_MUT_PROB
  ) +
  ggtitle("One-step Mutants") +
  theme(
    legend.position="bottom",
    strip.text.y=element_text(size=10)
  )
ggsave(
  paste0(working_directory, "plots/", "matrices_step-1.pdf"),
  height=15,
  width=12
)
```

### 2-step mutants

```{r}
limit <- max(abs(ls2_cooccur_data$cooccur_expectation_avg)) * c(-1, 1)
ggplot(
    ls2_cooccur_data,
    aes(
      x=task_1_id,
      y=task_2_id,
      fill=cooccur_expectation_avg
    )
  ) +
  geom_tile() +
  scale_fill_distiller(
    palette = "RdBu",
    limits=limit
    # limits=c(-10, 10)
  ) +
  facet_grid(
    env_condition~COPY_MUT_PROB
  ) +
  ggtitle("Two-step Mutants") +
  theme(
    legend.position="bottom",
    strip.text.y=element_text(size=10),
    legend.key.width=unit(3, "cm")
  )
ggsave(
  paste0(working_directory, "plots/", "matrices_step-2.pdf"),
  height=15,
  width=12
)
```